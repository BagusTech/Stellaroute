"use strict";void function(e,t,a){function c(t){t.stopPropagation(),t.preventDefault(),e(this).closest("[duck-type]").remove(),e(this).closest('[duck-type="array"]').trigger("duckArrayItemDeleted")}function r(d){d.stopPropagation(),d.preventDefault();var n=e(this),i=n.attr("duck-add"),u=n.attr("duck-targt"),o=u?e(u):n.closest('[duck-type="array"]'),l=o.find("[duck-type]").first(),f=l.parent().find("> [duck-type]").last(),k=o.prop("ArrayItemTemplate")?o.prop("ArrayItemTemplate").clone():l.clone();switch(i){case"after":n.closest("[duck-type]").after(k);break;case"before":n.closest("[duck-type]").before(k);break;default:f.after(k)}k.find('[duck-button="delete"]').click(c),k.find('[data-function="tabs"]').makeTabs(),k.find("[id]").each(function(a,c){var r=e(c),d=r.attr("id"),n=d+t.uuid();r.attr("id",n).prop("id",n)}),k.find('[data-function="accordion"]').makeAccordion(),"object"===l.attr("duck-type")&&(k.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),k.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote(a.summernoteOptions),k.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove(),k.find('[duck-button="add"]').click(r)),"image"===l.attr("duck-type")&&(k.prop("filePickerInitiated",!1),k.find("[duck-image-value]").text("")),k.find(".js-card").guideCard(),l.parent().sortable("[duck-type]"),o.trigger("duckArrayItemAdded",[k]),o.closest('[data-function*="scroll"]').trigger("initScroll")}function d(e,a,c,r){var d=a.attr("duck-key"),n=e[c]||{};d&&!n[d]&&(n[d]=a.attr("duck-key-value")||t.uuid()),e[c]=r(n,t.findRelevantChildren(a,"[duck-field]"))}function n(a,c,r,d){var n=t.findRelevantChildren(c,'[duck-type="object"]'),i=n.first().attr("duck-key")?a[r]||[]:[];n.length?n.each(function(a,c){var r=e(c),n=r.attr("duck-key"),u=r.attr("duck-key-value")||t.uuid(),o=n?i.filter(function(e){return e[n]===u})[0]||{}:{};if(n){o[n]=u;var l=i.map(function(e){return e[n]}).indexOf(o[n]);l!==-1&&i.splice(l,1)}i.push(d(o,t.findRelevantChildren(r,"[duck-field]")))}):c.find("[duck-value]").each(function(t,a){var c=e(a).val();c&&i.push(c)}),(a[r]||i.length)&&(a[r]=i)}function i(t,a,c){var r=[];a.find('input[type="checkbox"]').each(function(t,a){var c=e(a);c.prop("checked")&&r.push(c.val())}),(t[c]||r.length)&&(t[c]=r)}function u(e,t,a){var c=t.find('input[type="radio"]:checked').val();(e[a]||c)&&(e[a]=c)}function o(e,t,a){var c=t.find(".summernote").summernote("code");c&&(e[a]=c)}function l(t,a){return a.each(function(a,c){var r=e(c),f=r.attr("duck-field"),k=r.attr("duck-type");switch(k){case"object":d(t,r,f,l);break;case"array":n(t,r,f,l);break;case"checkbox":i(t,r,f);break;case"radio":u(t,r,f);break;case"bool":t[f]=r.prop("checked")||r.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":o(t,r,f);break;case"image":case"select":case"number":case"string":default:var p=r.val(),s=p?p:r.find("[duck-value]").val();(t[f]||s)&&(t[f]=s)}}),t}function f(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase()).trigger("validate")})}function k(e,a,c,r,d,n,i){var u={};u[c]=r||t.uuid();var o=l(u,d);t(a).add(o,n,i),e.trigger("duck.form.submitted",[o])}function p(e,a,c,r,d,n,i){t(a).get({field:c,value:r,findOne:!0},function(c){var r="Users"===a&&(c.local&&c.local.password),u=l(c,d);r&&u.local.password===r&&delete u.local.password,t(a).update(u,n,i),e.trigger("duck.form.submitted",[u])})}function s(e,c,r,d){var n={};n[r]=d,t(c).delete(d,function(){var t=a.location.href.split("/"),c=e.attr("duck-goTo");t[t.length-1]?t.pop():(t.pop(),t.pop());var r=c?c:t.join("/");a.location.href===r?a.location.reload(!0):a.location.href=r}),e.trigger("duck.form.submitted",[n])}function v(t){var a=t.data.wrapper;a.attr("duck-edit-form","view"===a.attr("duck-edit-form")?"edit":"view"),e('[data-function*="scroll"]').trigger("initScroll")}function m(e){e.preventDefault(),e.stopPropagation(),e.data.wrapper.trigger("duck.form.submit")}function y(t){t.preventDefault(),t.stopPropagation();var a=t.data.crud,c=t.data.table,r=t.data.key,d=t.data.keyValue,n=t.data.startOfFields,i=t.data.wrapper,u=t.data.successCallback,o=t.data.errorCallBack;switch(e(t.currentTarget).prop("disabled",!0),a){case"add":k(i,c,r,d,n,u,o);break;case"update":p(i,c,r,d,n,u,o);break;case"delete":s(i,c,r,d)}}function b(a,d){var n=e(a),i=t.findRelevantChildren(n,"[duck-field]"),u=n.find('[duck-button="edit"]'),o=n.find('[duck-button="cancel"]'),l=d&&d.table||n.attr("duck-table"),k=d&&d.crud||n.attr("duck-function"),p=d&&d.key||n.attr("duck-key"),s=d&&d.keyValue||n.attr("duck-key-value"),b=n.find('[duck-field="url"] input'),g=d&&d.successCallback||function(e){n.trigger("duck.form.success",[e])},h=d&&d.errorCallBack||function(){n.trigger("duck.form.error")};b.length&&f(b,n.find('[duck-field="names"] [duck-field="display"] input')),l&&k&&p&&("update"!==k&&"delete"!==k||s)&&(u.off("click",v).on("click",{wrapper:n},v),o.off("click",v).on("click",{wrapper:n},v),n.off("click",m).on("click",'[duck-button="submit"]',{wrapper:n},m),n.off("duck.form.submit",y).on("duck.form.submit",{crud:k,table:l,key:p,keyValue:s,wrapper:n,startOfFields:i,successCallback:g,errorCallBack:h},y),n.find('[duck-type="array"]').each(function(a,c){var r=e(c),d=t.findRelevantChildren(r,"[duck-type]");d.first().parent().sortable("[duck-type]")}),n.find('[duck-button="add"]').off("click",r).click(r),n.find('[duck-button="delete"]').off("click",c).click(c))}e.fn.duckForm=function(e){return this.each(function(t,a){b(a,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=form.min.js.map
