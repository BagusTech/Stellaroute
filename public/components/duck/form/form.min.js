"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,a){function r(t){t.stopPropagation(),t.preventDefault(),e(this).closest("[duck-type]").remove(),e(this).closest('[duck-type="array"]').trigger("duckArrayItemDeleted")}function c(n){n.stopPropagation(),n.preventDefault();var i=e(this),d=i.attr("duck-add"),o=i.attr("duck-targt"),u=o?e(o):i.closest('[duck-type="array"]'),l=u.find("[duck-type]").first(),f=l.parent().find("> [duck-type]").last(),p=u.prop("ArrayItemTemplate")?u.prop("ArrayItemTemplate").clone():l.clone();switch(d){case"after":i.closest("[duck-type]").after(p);break;case"before":i.closest("[duck-type]").before(p);break;default:f.after(p)}p.find('[duck-button="delete"]').click(r),p.find('[data-function="tabs"]').makeTabs(),p.find("[id]").each(function(a,r){var c=e(r),n=c.attr("id"),i=n+t.uuid();c.attr("id",i).prop("id",i)}),p.find('[data-function="accordion"]').makeAccordion(),"object"===l.attr("duck-type")&&(p.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),p.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote(a.summernoteOptions),p.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove(),p.find('[duck-button="add"]').click(c)),"image"===l.attr("duck-type")&&(p.prop("filePickerInitiated",!1),p.find("[duck-image-value]").text("")),p.find(".js-card").guideCard(),l.parent().sortable("[duck-type]"),u.trigger("duckArrayItemAdded",[p]),u.closest('[data-function*="scroll"]').trigger("initScroll")}function n(e,t,a){for(var r="string"==typeof t?t.split("."):t,c=r.length,i=function(t){var i=r[t],d=1===c,o="object"===_typeof(e[i]);if(d&&!o)delete e[i];else if(!o)return"break";var u=e[i]instanceof Array?"array":"object";if("object"===u){var l=r.slice(0);l.splice(0,1),e[i]=n(e[i],l,a)}else{var f=d?e[i].indexOf(a):e[i].map(function(e){return e[r[t+1]]}).indexOf(a);e[i].splice(f,1)}},d=0;d<c;d++){var o=i(d);if("break"===o)break}return e}function i(e,a,r,c){var n=a.attr("duck-key"),i=e[r]||{};n&&!i[n]&&(i[n]=a.attr("duck-key-value")||t.uuid()),e[r]=c(i,t.findRelevantChildren(a,"[duck-field]"))}function d(a,r,c,n){var i=t.findRelevantChildren(r,'[duck-type="object"]'),d=i.first().attr("duck-key")?a[c]||[]:[];i.length?i.each(function(a,r){var c=e(r),i=c.attr("duck-key"),o=c.attr("duck-key-value")||t.uuid(),u=i?d.filter(function(e){return e[i]===o})[0]||{}:{};if(i){u[i]=o;var l=d.map(function(e){return e[i]}).indexOf(u[i]);l!==-1&&d.splice(l,1)}d.push(n(u,t.findRelevantChildren(c,"[duck-field]")))}):r.find("[duck-value]").each(function(t,a){var r=e(a).val();r&&d.push(r)}),(a[c]||d.length)&&(a[c]=d)}function o(t,a,r){var c=[];a.find('input[type="checkbox"]').each(function(t,a){var r=e(a);r.prop("checked")&&c.push(r.val())}),(t[r]||c.length)&&(t[r]=c)}function u(e,t,a){var r=t.find('input[type="radio"]:checked').val();(e[a]||r)&&(e[a]=r)}function l(e,t,a,r){var c=r||".summernote",n=t.find(c).summernote("code");n&&(e[a]=n)}function f(t,a){return a.each(function(a,r){var c=e(r),n=c.attr("duck-field"),p=c.attr("duck-type");switch(p){case"object":i(t,c,n,f);break;case"array":d(t,c,n,f);break;case"checkbox":o(t,c,n);break;case"radio":u(t,c,n);break;case"bool":t[n]=c.prop("checked")||c.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":l(t,c,n);break;case"image":case"select":case"number":case"string":default:var k=c.val(),s=k?k:c.find("[duck-value]").val();(t[n]||s)&&(t[n]=s)}}),t}function p(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase()).trigger("validate")})}function k(e,a,r,c,n,i){var d={};d[a]=r||t.uuid(),t(e).add(f(d,c),n,i)}function s(e,a,r,c,n,i){t(e).get({field:a,value:r,findOne:!0},function(a){var r="Users"===e&&(a.local&&a.local.password),d=f(a,c);r&&d.local.password===r&&delete d.local.password,t(e).update(d,n,i)})}function y(e,r,c,n){t(e).delete(c,function(){var e=a.location.href.split("/"),t=n.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var r=t?t:e.join("/");a.location.href===r?a.location.reload(!0):a.location.href=r})}function v(e,a,r,c,i,d){var o=c.attr("duck-delete-path"),u=c.attr("duck-delete-value");t(e).get({field:a,value:r,findOne:!0},function(a){var r=n(a,o,u);t(e).update(r,i,d)})}function b(t){var a=t.data.wrapper;a.attr("duck-edit-form","view"===a.attr("duck-edit-form")?"edit":"view"),e('[data-function*="scroll"]').trigger("initScroll")}function m(e){e.preventDefault(),e.stopPropagation(),e.data.wrapper.trigger("duck.form.submit")}function g(t){t.preventDefault(),t.stopPropagation();var a=t.data.crud,r=t.data.table,c=t.data.key,n=t.data.keyValue,i=t.data.startOfFields,d=t.data.wrapper,o=t.data.successCallback,u=t.data.errorCallBack;switch(e(t.currentTarget).prop("disabled",!0),d.trigger("duck.form.submitted"),a){case"add":k(r,c,n,i,o,u);break;case"update":s(r,c,n,i,o,u);break;case"delete":y(r,c,n,d);break;case"deleteField":v(r,c,n,d,o,u)}}function h(a,n){var i=e(a),d=t.findRelevantChildren(i,"[duck-field]"),o=i.find('[duck-button="edit"]'),u=i.find('[duck-button="cancel"]'),l=n&&n.table||i.attr("duck-table"),f=n&&n.crud||i.attr("duck-function"),k=n&&n.key||i.attr("duck-key"),s=n&&n.keyValue||i.attr("duck-key-value"),y=i.find('[duck-field="url"] input'),v=n&&n.successCallback||function(){i.trigger("duck.form.success")},h=n&&n.errorCallBack||function(){i.trigger("duck.form.error")};y.length&&p(y,i.find('[duck-field="names"] [duck-field="display"] input')),l&&f&&k&&("update"!==f&&"delete"!==f||s)&&(o.off("click",b).on("click",{wrapper:i},b),u.off("click",b).on("click",{wrapper:i},b),i.off("click",m).on("click",'[duck-button="submit"]',{wrapper:i},m),i.off("duck.form.submit",g).on("duck.form.submit",{crud:f,table:l,key:k,keyValue:s,wrapper:i,startOfFields:d,successCallback:v,errorCallBack:h},g),i.find('[duck-type="array"]').each(function(a,r){var c=e(r),n=t.findRelevantChildren(c,"[duck-type]");n.first().parent().sortable("[duck-type]")}),i.find('[duck-button="add"]').off("click",c).click(c),i.find('[duck-button="delete"]').off("click",r).click(r))}e.fn.duckForm=function(e){return this.each(function(t,a){h(a,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=form.min.js.map
