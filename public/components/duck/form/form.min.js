"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,a){function c(t){t.stopPropagation(),t.preventDefault(),e(this).closest("[duck-type]").remove(),e(this).closest('[duck-type="array"]').trigger("duckArrayItemDeleted")}function r(n){n.stopPropagation(),n.preventDefault();var i=e(this),d=i.attr("duck-add"),u=i.attr("duck-targt"),o=u?e(u):i.closest('[duck-type="array"]'),l=o.find("[duck-type]").first(),f=l.parent().find("> [duck-type]").last(),k=o.prop("ArrayItemTemplate")?o.prop("ArrayItemTemplate").clone():l.clone();switch(d){case"after":i.closest("[duck-type]").after(k);break;case"before":i.closest("[duck-type]").before(k);break;default:f.after(k)}k.find('[duck-value], [duck-type="wysiwyg"]').val(null),k.find('[duck-button="delete"]').click(c),k.find('[data-function="tabs"]').makeTabs(),k.find("[id]").each(function(a,c){var r=e(c),n=r.attr("id"),i=n+t.uuid();r.attr("id",i).prop("id",i)}),k.find('[data-function="accordion"]').makeAccordion(),k.find(".js-card").guideCard(),"object"===l.attr("duck-type")&&(k.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),k.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote(a.summernoteOptions),k.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove(),k.find('[duck-button="add"]').click(r)),"image"===l.attr("duck-type")&&(k.prop("filePickerInitiated",!1),k.find("[duck-image-value]").text("")),l.parent().sortable("[duck-type]"),o.trigger("duckArrayItemAdded"),o.closest('[data-function*="scroll"]').trigger("initScroll")}function n(e,t,a){for(var c="string"==typeof t?t.split("."):t,r=c.length,i=function(t){var i=c[t],d=1===r,u="object"===_typeof(e[i]);if(d&&!u)delete e[i];else if(!u)return"break";var o=e[i]instanceof Array?"array":"object";if("object"===o){var l=c.slice(0);l.splice(0,1),e[i]=n(e[i],l,a)}else{var f=d?e[i].indexOf(a):e[i].map(function(e){return e[c[t+1]]}).indexOf(a);e[i].splice(f,1)}},d=0;d<r;d++){var u=i(d);if("break"===u)break}return e}function i(e,a,c,r){var n=a.attr("duck-key"),i=e[c]||{};n&&!i[n]&&(i[n]=a.attr("duck-key-value")||t.uuid()),e[c]=r(i,t.findRelevantChildren(a,"[duck-field]"))}function d(a,c,r,n){var i=t.findRelevantChildren(c,'[duck-type="object"]'),d=i.first().attr("duck-key")?a[r]||[]:[];i.length?i.each(function(a,c){var r=e(c),i=r.attr("duck-key"),u=r.attr("duck-key-value")||t.uuid(),o=i?d.filter(function(e){return e[i]===u})[0]||{}:{};if(i){o[i]=u;var l=d.map(function(e){return e[i]}).indexOf(o[i]);l!==-1&&d.splice(l,1)}d.push(n(o,t.findRelevantChildren(r,"[duck-field]")))}):c.find("[duck-value]").each(function(t,a){var c=e(a).val();c&&d.push(c)}),(a[r]||d.length)&&(a[r]=d)}function u(t,a,c){var r=[];a.find('input[type="checkbox"]').each(function(t,a){var c=e(a);c.prop("checked")&&r.push(c.val())}),(t[c]||r.length)&&(t[c]=r)}function o(e,t,a){var c=t.find('input[type="radio"]:checked').val();(e[a]||c)&&(e[a]=c)}function l(e,t,a,c){var r=c||".summernote",n=t.find(r).summernote("code");n&&(e[a]=n)}function f(t,a){return a.each(function(a,c){var r=e(c),n=r.attr("duck-field"),k=r.attr("duck-type");switch(k){case"object":i(t,r,n,f);break;case"array":d(t,r,n,f);break;case"checkbox":u(t,r,n);break;case"radio":o(t,r,n);break;case"bool":t[n]=r.prop("checked")||r.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":l(t,r,n);break;case"image":case"select":case"number":case"string":default:var p=r.val(),s=p?p:r.find("[duck-value]").val();(t[n]||s)&&(t[n]=s)}}),t}function k(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase()).trigger("validate")})}function p(e,a,c,r,n,i){var d={};d[a]=c||t.uuid(),t(e).add(f(d,r),n,i)}function s(e,a,c,r,n,i){t(e).get({field:a,value:c,findOne:!0},function(a){var c=f(a,r);t(e).update(c,n,i)})}function y(e,c,r,n){t(e).delete(r,function(){var e=a.location.href.split("/"),t=n.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var c=t?t:e.join("/");a.location.href===c?a.location.reload(!0):a.location.href=c})}function v(e,a,c,r,i,d){var u=r.attr("duck-delete-path"),o=r.attr("duck-delete-value");t(e).get({field:a,value:c,findOne:!0},function(a){var c=n(a,u,o);t(e).update(c,i,d)})}function b(t){var a=t.data.wrapper;a.attr("duck-edit-form","view"===a.attr("duck-edit-form")?"edit":"view"),e('[data-function*="scroll"]').trigger("initScroll")}function m(t){t.preventDefault(),t.stopPropagation();var a=t.data.crud,c=t.data.table,r=t.data.key,n=t.data.keyValue,i=t.data.startOfFields,d=t.data.wrapper,u=t.data.successCallback,o=t.data.errorCallBack;switch(e(t.currentTarget).prop("disabled",!0),d.trigger("duck.form.submitted"),a){case"add":p(c,r,n,i,u,o);break;case"update":s(c,r,n,i,u,o);break;case"delete":y(c,r,n,d);break;case"deleteField":v(c,r,n,d,u,o)}}function h(a,n){var i=e(a),d=t.findRelevantChildren(i,"[duck-field]"),u=i.find('[duck-button="edit"]'),o=i.find('[duck-button="cancel"]'),l=n&&n.table||i.attr("duck-table"),f=n&&n.crud||i.attr("duck-function"),p=n&&n.key||i.attr("duck-key"),s=n&&n.keyValue||i.attr("duck-key-value"),y=i.find('[duck-field="url"] input'),v=n&&n.successCallback||function(){i.trigger("duck.form.success")},h=n&&n.errorCallBack||function(){i.trigger("duck.form.error")};y.length&&k(y,i.find('[duck-field="names"] [duck-field="display"] input')),l&&f&&p&&("update"!==f&&"delete"!==f||s)&&(u.off("click",b).on("click",{wrapper:i},b),o.off("click",b).on("click",{wrapper:i},b),i.off("click",m).on("click",'[duck-button="submit"]',{crud:f,table:l,key:p,keyValue:s,wrapper:i,startOfFields:d,successCallback:v,errorCallBack:h},m),i.find('[duck-type="array"]').each(function(a,c){var r=e(c),n=t.findRelevantChildren(r,"[duck-type]");n.first().parent().sortable("[duck-type]")}),i.find('[duck-button="add"]').off("click",r).click(r),i.find('[duck-button="delete"]').off("click",c).click(c))}e.fn.duckForm=function(e){return this.each(function(t,a){h(a,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=form.min.js.map
