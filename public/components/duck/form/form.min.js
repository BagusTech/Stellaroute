"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,a){function r(t){t.stopPropagation(),t.preventDefault(),e(this).closest("[duck-type]").remove(),e(this).closest('[duck-type="array"]').trigger("duckArrayItemDeleted")}function c(n){n.stopPropagation(),n.preventDefault();var i=e(this),d=i.attr("duck-add"),o=i.attr("duck-targt"),u=o?e(o):i.closest('[duck-type="array"]'),f=u.find("[duck-type]").first(),l=f.parent().find("> [duck-type]").last(),k=u.prop("ArrayItemTemplate")?u.prop("ArrayItemTemplate").clone():f.clone();switch(d){case"after":i.closest("[duck-type]").after(k);break;case"before":i.closest("[duck-type]").before(k);break;default:l.after(k)}k.find('[duck-button="delete"]').click(r),k.find('[data-function="tabs"]').makeTabs(),k.find("[id]").each(function(a,r){var c=e(r),n=c.attr("id"),i=n+t.uuid();c.attr("id",i).prop("id",i)}),k.find('[data-function="accordion"]').makeAccordion(),"object"===f.attr("duck-type")&&(k.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),k.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote(a.summernoteOptions),k.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove(),k.find('[duck-button="add"]').click(c)),"image"===f.attr("duck-type")&&(k.prop("filePickerInitiated",!1),k.find("[duck-image-value]").text("")),k.find(".js-card").guideCard(),f.parent().sortable("[duck-type]"),u.trigger("duckArrayItemAdded",[k]),u.closest('[data-function*="scroll"]').trigger("initScroll")}function n(e,t,a){for(var r="string"==typeof t?t.split("."):t,c=r.length,i=function(t){var i=r[t],d=1===c,o="object"===_typeof(e[i]);if(d&&!o)delete e[i];else if(!o)return"break";var u=e[i]instanceof Array?"array":"object";if("object"===u){var f=r.slice(0);f.splice(0,1),e[i]=n(e[i],f,a)}else{var l=d?e[i].indexOf(a):e[i].map(function(e){return e[r[t+1]]}).indexOf(a);e[i].splice(l,1)}},d=0;d<c;d++){var o=i(d);if("break"===o)break}return e}function i(e,a,r,c){var n=a.attr("duck-key"),i=e[r]||{};n&&!i[n]&&(i[n]=a.attr("duck-key-value")||t.uuid()),e[r]=c(i,t.findRelevantChildren(a,"[duck-field]"))}function d(a,r,c,n){var i=t.findRelevantChildren(r,'[duck-type="object"]'),d=i.first().attr("duck-key")?a[c]||[]:[];i.length?i.each(function(a,r){var c=e(r),i=c.attr("duck-key"),o=c.attr("duck-key-value")||t.uuid(),u=i?d.filter(function(e){return e[i]===o})[0]||{}:{};if(i){u[i]=o;var f=d.map(function(e){return e[i]}).indexOf(u[i]);f!==-1&&d.splice(f,1)}d.push(n(u,t.findRelevantChildren(c,"[duck-field]")))}):r.find("[duck-value]").each(function(t,a){var r=e(a).val();r&&d.push(r)}),(a[c]||d.length)&&(a[c]=d)}function o(t,a,r){var c=[];a.find('input[type="checkbox"]').each(function(t,a){var r=e(a);r.prop("checked")&&c.push(r.val())}),(t[r]||c.length)&&(t[r]=c)}function u(e,t,a){var r=t.find('input[type="radio"]:checked').val();(e[a]||r)&&(e[a]=r)}function f(e,t,a,r){var c=r||".summernote",n=t.find(c).summernote("code");n&&(e[a]=n)}function l(t,a){return a.each(function(a,r){var c=e(r),n=c.attr("duck-field"),k=c.attr("duck-type");switch(k){case"object":i(t,c,n,l);break;case"array":d(t,c,n,l);break;case"checkbox":o(t,c,n);break;case"radio":u(t,c,n);break;case"bool":t[n]=c.prop("checked")||c.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":f(t,c,n);break;case"image":case"select":case"number":case"string":default:var p=c.val(),s=p?p:c.find("[duck-value]").val();(t[n]||s)&&(t[n]=s)}}),t}function k(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase()).trigger("validate")})}function p(e,a,r,c,n,i,d){var o={};o[r]=c||t.uuid();var u=l(o,n);t(a).add(u,i,d),e.trigger("duck.form.submitted",[u])}function s(e,a,r,c,n,i,d){t(a).get({field:r,value:c,findOne:!0},function(r){var c="Users"===a&&(r.local&&r.local.password),o=l(r,n);c&&o.local.password===c&&delete o.local.password,t(a).update(o,i,d),e.trigger("duck.form.submitted",[o])})}function y(e,r,c,n){var i={};i[c]=n,t(r).delete(n,function(){var t=a.location.href.split("/"),r=e.attr("duck-goTo");t[t.length-1]?t.pop():(t.pop(),t.pop());var c=r?r:t.join("/");a.location.href===c?a.location.reload(!0):a.location.href=c}),e.trigger("duck.form.submitted",[i])}function v(e,a,r,c,i,d){var o=e.attr("duck-delete-path"),u=e.attr("duck-delete-value");t(a).get({field:r,value:c,findOne:!0},function(r){var c=n(r,o,u);e.trigger("duck.form.submitted",[c]),t(a).update(c,i,d)})}function b(t){var a=t.data.wrapper;a.attr("duck-edit-form","view"===a.attr("duck-edit-form")?"edit":"view"),e('[data-function*="scroll"]').trigger("initScroll")}function m(e){e.preventDefault(),e.stopPropagation(),e.data.wrapper.trigger("duck.form.submit")}function g(t){t.preventDefault(),t.stopPropagation();var a=t.data.crud,r=t.data.table,c=t.data.key,n=t.data.keyValue,i=t.data.startOfFields,d=t.data.wrapper,o=t.data.successCallback,u=t.data.errorCallBack;switch(e(t.currentTarget).prop("disabled",!0),a){case"add":p(d,r,c,n,i,o,u);break;case"update":s(d,r,c,n,i,o,u);break;case"delete":y(d,r,c,n);break;case"deleteField":v(r,c,n,o,u)}}function h(a,n){var i=e(a),d=t.findRelevantChildren(i,"[duck-field]"),o=i.find('[duck-button="edit"]'),u=i.find('[duck-button="cancel"]'),f=n&&n.table||i.attr("duck-table"),l=n&&n.crud||i.attr("duck-function"),p=n&&n.key||i.attr("duck-key"),s=n&&n.keyValue||i.attr("duck-key-value"),y=i.find('[duck-field="url"] input'),v=n&&n.successCallback||function(){i.trigger("duck.form.success")},h=n&&n.errorCallBack||function(){i.trigger("duck.form.error")};y.length&&k(y,i.find('[duck-field="names"] [duck-field="display"] input')),f&&l&&p&&("update"!==l&&"delete"!==l||s)&&(o.off("click",b).on("click",{wrapper:i},b),u.off("click",b).on("click",{wrapper:i},b),i.off("click",m).on("click",'[duck-button="submit"]',{wrapper:i},m),i.off("duck.form.submit",g).on("duck.form.submit",{crud:l,table:f,key:p,keyValue:s,wrapper:i,startOfFields:d,successCallback:v,errorCallBack:h},g),i.find('[duck-type="array"]').each(function(a,r){var c=e(r),n=t.findRelevantChildren(c,"[duck-type]");n.first().parent().sortable("[duck-type]")}),i.find('[duck-button="add"]').off("click",c).click(c),i.find('[duck-button="delete"]').off("click",r).click(r))}e.fn.duckForm=function(e){return this.each(function(t,a){h(a,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=form.min.js.map
