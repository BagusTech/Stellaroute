"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};void function(t,e,n){function c(){t(this).parent().remove()}function a(){var e=t(this),n=e.parent(),i=n.find("> [duck-type]").first(),r=i.clone();r.find("[duck-value]").val(null),"object"===i.attr("duck-type")&&(r.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),r.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote({height:150}),r.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove()),r.append(t("<button>",{text:"Delete",class:"btn btn-danger btn-small","duck-button":"add",type:"button",click:c})),r.find('[duck-button="add"]').click(a),e.before(r)}function i(t,e,n){for(var c="string"==typeof e?e.split("."):e,a=c.length,r=function(e){var r=c[e],u=1===a,o="object"===_typeof(t[r]);if(u&&!o)delete t[r];else if(!o)return"break";var d=t[r]instanceof Array?"array":"object";if("object"===d){var f=c.slice(0);f.splice(0,1),t[r]=i(t[r],f,n)}else{var l=u?t[r].indexOf(n):t[r].map(function(t){return t[c[e+1]]}).indexOf(n);t[r].splice(l,1)}},u=0;u<a;u++){var o=r(u);if("break"===o)break}return t}function r(t,n,c,a){var i=n.attr("duck-key"),r=t[c]||{};i&&!r[i]&&(r[i]=n.attr("duck-key-value")||e.uuid()),t[c]=a(r,n.find("> [duck-field]"))}function u(n,c,a,i){var r=c.find('> [duck-type="object"]'),u=r.first().attr("duck-key")?n[a]:[];r.length?r.each(function(n,c){var a=t(c),r=a.attr("duck-key"),o=a.attr("duck-key-value")||e.uuid(),d=r?u.filter(function(t){return t[r]===o})[0]:{};if(r){d[r]=o;var f=u.map(function(t){return t[r]}).indexOf(d[r]);f!==-1&&u.splice(f,1)}u.push(i(d,a.find("> [duck-field]")))}):c.find("[duck-value]").each(function(e,n){var c=t(n).val();c&&u.push(c)}),(n[a]||u.length)&&(n[a]=u)}function o(e,n,c){var a=[];n.find('input[type="checkbox"]').each(function(e,n){var c=t(n);c.prop("checked")&&a.push(c.val())}),(e[c]||a.length)&&(e[c]=a)}function d(t,e,n){var c=e.find('input[type="radio"]:checked').val();(t[n]||c)&&(t[n]=c)}function f(t,e,n,c){var a=c||".summernote",i=e.find(a).summernote("code");i&&(t[n]=i)}function l(e,n){return n.each(function(n,c){var a=t(c),i=a.attr("duck-field"),k=a.attr("duck-type");switch(k){case"object":r(e,a,i,l);break;case"array":u(e,a,i,l);break;case"checkbox":o(e,a,i);break;case"radio":d(e,a,i);break;case"bool":e[i]=a.prop("checked")||a.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":f(e,a,i);break;case"image":case"select":case"number":case"string":default:var p=a.val(),s=p?p:a.find("[duck-value]").val();(e[i]||s)&&(e[i]=s)}}),e}function k(t,e){e.on("input",function(){t.val(e.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase())})}function p(r){var u=t(r),o=u.find("> [duck-field]"),d=u.find('[duck-button="edit"]'),f=u.find('[duck-button="cancel"]'),p=u.attr("duck-table"),s=u.attr("duck-function"),b=u.attr("duck-key"),v=u.attr("duck-key-value"),y=u.find('[duck-field="url"] input');y.length&&k(y,u.find('[duck-field="names"] [duck-field="display"] input')),p&&s&&b&&("update"!==s&&"delete"!==s||v)&&(d.click(function(){u.attr("duck-edit-form","view"===u.attr("duck-edit-form")?"edit":"view")}),f.click(function(){u.attr("duck-edit-form","view"===u.attr("duck-edit-form")?"edit":"view")}),u.on("click",'[duck-button="submit"]',function(c){switch(c.preventDefault(),c.stopPropagation(),t(c.currentTarget).prop("disabled",!0),s){case"add":var a={};a[b]=v||e.uuid(),e(p).add(l(a,o),function(){n.location.reload(!0)});break;case"update":e(p).get({field:b,value:v,findOne:!0},function(t){var c=l(t,o);e(p).update(c,function(){n.location.reload(!0)})});break;case"delete":e(p).delete(v,function(){var t=n.location.href.split("/"),e=u.attr("duck-goTo");t[t.length-1]?t.pop():(t.pop(),t.pop());var c=e?e:t.join("/");n.location.href===c?n.location.reload(!0):n.location.href=c});break;case"deleteField":var r=function(){var t=u.attr("duck-delete-path"),c=u.attr("duck-delete-value");return e(p).get({field:b,value:v,findOne:!0},function(a){var r=i(a,t,c);e(p).update(r,function(){n.location.reload(!0)})}),"break"}();if("break"===r)break}}),u.find('[duck-type="array"]').each(function(e,n){var i=t(n),r=t("<button>",{text:"Add "+i.attr("duck-field"),class:"btn btn-primary btn-small","duck-button":"add",type:"button",click:a});i.append(r),i.find("> [duck-type]").each(function(e,n){if(0!==e){var a=t(n),i=t("<button>",{text:"Delete",class:"btn btn-danger btn-small","duck-button":"delete",click:c});a.append(i)}})}))}t.fn.duckForm=function(){return this.each(function(t,e){p(e)})},t(n).on("load",function(){t("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=duckForm.min.js.map
