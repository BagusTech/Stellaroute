"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,n){function c(t){t.stopPropagation(),t.preventDefault(),e(this).closest("[duck-type]").remove()}function a(t){t.stopPropagation(),t.preventDefault();var n=e(this),i=n.attr("duck-add"),r=n.closest('[duck-type="array"]'),u=r.find("[duck-type]").first(),d=u.parent().find("> [duck-type]").last(),o=u.clone();switch(o.find('[duck-value], [duck-type="wysiwyg"]').val(null),o.find('[duck-button="delete"]').click(c),o.find('[data-function="tabs"]').makeTabs(),"object"===u.attr("duck-type")&&(o.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),o.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote({height:150}),o.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove(),o.find('[duck-button="add"]').click(a)),i){case"after":n.closest("[duck-type]").after(o);break;case"before":n.closest("[duck-type]").before(o);break;default:d.after(o)}u.parent().sortable("[duck-type]")}function i(e,t,n){for(var c="string"==typeof t?t.split("."):t,a=c.length,r=function(t){var r=c[t],u=1===a,d="object"===_typeof(e[r]);if(u&&!d)delete e[r];else if(!d)return"break";var o=e[r]instanceof Array?"array":"object";if("object"===o){var f=c.slice(0);f.splice(0,1),e[r]=i(e[r],f,n)}else{var l=u?e[r].indexOf(n):e[r].map(function(e){return e[c[t+1]]}).indexOf(n);e[r].splice(l,1)}},u=0;u<a;u++){var d=r(u);if("break"===d)break}return e}function r(e,n,c,a){var i=n.attr("duck-key"),r=e[c]||{};i&&!r[i]&&(r[i]=n.attr("duck-key-value")||t.uuid()),e[c]=a(r,t.findRelevantChildren(n,"[duck-field]"))}function u(n,c,a,i){var r=t.findRelevantChildren(c,'[duck-type="object"]'),u=r.first().attr("duck-key")?n[a]||[]:[];r.length?r.each(function(n,c){var a=e(c),r=a.attr("duck-key"),d=a.attr("duck-key-value")||t.uuid(),o=r?u.filter(function(e){return e[r]===d})[0]||{}:{};if(r){o[r]=d;var f=u.map(function(e){return e[r]}).indexOf(o[r]);f!==-1&&u.splice(f,1)}u.push(i(o,t.findRelevantChildren(a,"[duck-field]")))}):c.find("[duck-value]").each(function(t,n){var c=e(n).val();c&&u.push(c)}),(n[a]||u.length)&&(n[a]=u)}function d(t,n,c){var a=[];n.find('input[type="checkbox"]').each(function(t,n){var c=e(n);c.prop("checked")&&a.push(c.val())}),(t[c]||a.length)&&(t[c]=a)}function o(e,t,n){var c=t.find('input[type="radio"]:checked').val();(e[n]||c)&&(e[n]=c)}function f(e,t,n,c){var a=c||".summernote",i=t.find(a).summernote("code");i&&(e[n]=i)}function l(t,n){return n.each(function(n,c){var a=e(c),i=a.attr("duck-field"),k=a.attr("duck-type");switch(k){case"object":r(t,a,i,l);break;case"array":u(t,a,i,l);break;case"checkbox":d(t,a,i);break;case"radio":o(t,a,i);break;case"bool":t[i]=a.prop("checked")||a.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":f(t,a,i);break;case"image":case"select":case"number":case"string":default:var p=a.val(),s=p?p:a.find("[duck-value]").val();(t[i]||s)&&(t[i]=s)}}),t}function k(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase())})}function p(r,u){var d=e(r),o=t.findRelevantChildren(d,"[duck-field]"),f=d.find('[duck-button="edit"]'),p=d.find('[duck-button="cancel"]'),s=u&&u.table||d.attr("duck-table"),v=u&&u.crud||d.attr("duck-function"),y=u&&u.key||d.attr("duck-key"),b=u&&u.keyValue||d.attr("duck-key-value"),h=d.find('[duck-field="url"] input'),m=u&&u.successCallback||function(){n.location.reload(!0)},g=u&&u.failureCallBack||function(){n.location.reload(!0)};h.length&&k(h,d.find('[duck-field="names"] [duck-field="display"] input')),s&&v&&y&&("update"!==v&&"delete"!==v||b)&&(f.click(function(){d.attr("duck-edit-form","view"===d.attr("duck-edit-form")?"edit":"view"),e('[data-function*="scroll"]').trigger("initScroll")}),p.click(function(){d.attr("duck-edit-form","view"===d.attr("duck-edit-form")?"edit":"view")}),d.on("click",'[duck-button="submit"]',function(c){switch(c.preventDefault(),c.stopPropagation(),e(c.currentTarget).prop("disabled",!0),v){case"add":var a={};a[y]=b||t.uuid(),t(s).add(l(a,o),m,g);break;case"update":t(s).get({field:y,value:b,findOne:!0},function(e){var n=l(e,o);t(s).update(n,m,g)});break;case"delete":t(s).delete(b,function(){var e=n.location.href.split("/"),t=d.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var c=t?t:e.join("/");n.location.href===c?n.location.reload(!0):n.location.href=c});break;case"deleteField":var r=function(){var e=d.attr("duck-delete-path"),n=d.attr("duck-delete-value");return t(s).get({field:y,value:b,findOne:!0},function(c){var a=i(c,e,n);t(s).update(a,m,g)}),"break"}();if("break"===r)break}}),d.find('[duck-type="array"]').each(function(t,n){var i=e(n),r=i.find('[duck-button="add"]');r.off("click",a).click(a),i.find("> [duck-type]").each(function(t,n){var a=e(n),i=a.find('[duck-button="delete"]');i.off("click",c).click(c)})}).sortable("[duck-type]"))}e.fn.duckForm=function(e){return this.each(function(t,n){p(n,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=duckForm.min.js.map
