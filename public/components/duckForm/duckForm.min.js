"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e,t,n){function o(t){t.stopPropagation(),e(this).closest("[duck-type]").remove()}function c(){var n=e(this),a=n.closest('[duck-type="array"]'),u=a.find("[duck-type]").first(),i=u.clone();i.find('[duck-value], [duck-type="wysiwyg"]').val(null).on("mousedown",t.stopProp),i.find(".btn-danger").click(o).on("mousedown",t.stopProp),"object"===u.attr("duck-type")&&(i.find('input[type="checkbox"], input[type="radio"]').prop("checked",!1),i.find(".summernote").parent().empty().append('<div class="summernote"></div>').find("> .summernote").summernote({height:150}),i.find('[duck-type="array"] > [duck-type]:not(:first-of-type)').remove(),i.find('[duck-button="add"]').click(c)),u.parent().append(i),u.parent().sortable("[duck-type]")}function a(e,t,n){for(var o="string"==typeof t?t.split("."):t,c=o.length,u=function(t){var u=o[t],i=1===c,r="object"===_typeof(e[u]);if(i&&!r)delete e[u];else if(!r)return"break";var d=e[u]instanceof Array?"array":"object";if("object"===d){var f=o.slice(0);f.splice(0,1),e[u]=a(e[u],f,n)}else{var l=i?e[u].indexOf(n):e[u].map(function(e){return e[o[t+1]]}).indexOf(n);e[u].splice(l,1)}},i=0;i<c;i++){var r=u(i);if("break"===r)break}return e}function u(e,n,o,c){var a=n.attr("duck-key"),u=e[o]||{};a&&!u[a]&&(u[a]=n.attr("duck-key-value")||t.uuid()),e[o]=c(u,t.findRelevantChildren(n,"[duck-field]"))}function i(n,o,c,a){var u=o.find('> [duck-type="object"]'),i=u.first().attr("duck-key")?n[c]:[];u.length?u.each(function(n,o){var c=e(o),u=c.attr("duck-key"),r=c.attr("duck-key-value")||t.uuid(),d=u?i.filter(function(e){return e[u]===r})[0]:{};if(u){d[u]=r;var f=i.map(function(e){return e[u]}).indexOf(d[u]);f!==-1&&i.splice(f,1)}i.push(a(d,t.findRelevantChildren(c,"[duck-field]")))}):o.find("[duck-value]").each(function(t,n){var o=e(n).val();o&&i.push(o)}),(n[c]||i.length)&&(n[c]=i)}function r(t,n,o){var c=[];n.find('input[type="checkbox"]').each(function(t,n){var o=e(n);o.prop("checked")&&c.push(o.val())}),(t[o]||c.length)&&(t[o]=c)}function d(e,t,n){var o=t.find('input[type="radio"]:checked').val();(e[n]||o)&&(e[n]=o)}function f(e,t,n,o){var c=o||".summernote",a=t.find(c).summernote("code");a&&(e[n]=a)}function l(t,n){return n.each(function(n,o){var c=e(o),a=c.attr("duck-field"),p=c.attr("duck-type");switch(p){case"object":u(t,c,a,l);break;case"array":i(t,c,a,l);break;case"checkbox":r(t,c,a);break;case"radio":d(t,c,a);break;case"bool":t[a]=c.prop("checked")||c.find('input[type="checkbox"]').prop("checked");break;case"wysiwyg":f(t,c,a);break;case"image":case"select":case"number":case"string":default:var k=c.val(),s=k?k:c.find("[duck-value]").val();(t[a]||s)&&(t[a]=s)}}),t}function p(e,t){t.on("input",function(){e.val(t.val().replace(/'/g,"").replace(/[^a-zA-Z0-9]/g,"-").toLowerCase())})}function k(u,i){var r=e(u),d=t.findRelevantChildren(r,"[duck-field]"),f=r.find('[duck-button="edit"]'),k=r.find('[duck-button="cancel"]'),s=i&&i.table||r.attr("duck-table"),v=i&&i.crud||r.attr("duck-function"),y=i&&i.key||r.attr("duck-key"),b=i&&i.keyValue||r.attr("duck-key-value"),m=r.find('[duck-field="url"] input'),h=i&&i.successCallback||function(){n.location.reload(!0)},g=i&&i.failureCallBack||function(){n.location.reload(!0)};m.length&&p(m,r.find('[duck-field="names"] [duck-field="display"] input')),s&&v&&y&&("update"!==v&&"delete"!==v||b)&&(f.click(function(){r.attr("duck-edit-form","view"===r.attr("duck-edit-form")?"edit":"view")}),k.click(function(){r.attr("duck-edit-form","view"===r.attr("duck-edit-form")?"edit":"view")}),r.on("click",'[duck-button="submit"]',function(o){switch(o.preventDefault(),o.stopPropagation(),e(o.currentTarget).prop("disabled",!0),v){case"add":var c={};c[y]=b||t.uuid(),t(s).add(l(c,d),h,g);break;case"update":t(s).get({field:y,value:b,findOne:!0},function(e){var n=l(e,d);t(s).update(n,h,g)});break;case"delete":t(s).delete(b,function(){var e=n.location.href.split("/"),t=r.attr("duck-goTo");e[e.length-1]?e.pop():(e.pop(),e.pop());var o=t?t:e.join("/");n.location.href===o?n.location.reload(!0):n.location.href=o});break;case"deleteField":var u=function(){var e=r.attr("duck-delete-path"),n=r.attr("duck-delete-value");return t(s).get({field:y,value:b,findOne:!0},function(o){var c=a(o,e,n);t(s).update(c,h,g)}),"break"}();if("break"===u)break}}),r.find('[duck-type="array"]').each(function(n,a){var u=e(a),i=u.find('[duck-button="add"]');if(0===i.length){var r=e("<button>",{class:"btn-small","duck-button":"add",type:"button",click:c,mousedown:t.stopProp});u.prepend(r)}else i.off("click",c).click(c).off("mousedown",t.stopProp).on("mousedown",t.stopProp);u.find("> [duck-type]").each(function(n,c){var a=e(c),u=a.find('[duck-button="delete"]');if(0===u.length){var i=e("<button>",{class:"btn-danger btn-small","duck-button":"delete",type:"button",click:o,mousedown:t.stopProp});a.append(i)}else u.off("click",o).click(o).off("mousedown",t.stopProp).on("mousedown",t.stopProp)})}).sortable("[duck-type]").find('[duck-value], [duck-type="wysiwyg"]').on("mousedown",t.stopProp))}e.fn.duckForm=function(e){return this.each(function(t,n){k(n,e)})},e(function(){e("[duck-table]").duckForm()})}(jQuery.noConflict(),duck,window);
//# sourceMappingURL=duckForm.min.js.map
