"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};void function(e){function t(t,a){var n=t.data.wrapper;return n.trigger("gettingFiles"),a&&a.files?void n.trigger("gotFiles",[null,a]):void e.ajax({type:"GET",url:"/getFiles",dataType:"json",contentType:"application/json",data:a||{},success:function(e){n.trigger("gotFiles",[null,e])},error:function(e){n.trigger("gotFiles",[e])}})}function a(t,a){var n=t.data.wrapper,i=a;if(i.length>0){n.trigger("fileUploading");for(var o=new FormData,r=0;r<i.length;r++){var l=i[r];o.append("files",l,l.name)}o.append("filePath",n.prop("uploadFilePath")),e.ajax({url:"/upload",type:"POST",data:o,processData:!1,contentType:!1,success:function(){n.trigger("filesUploaded")},error:function(e){n.trigger("filesUploaded",[e])}})}else n.trigger("fileUploading",[!0])}function n(t,a){var n=t.data.wrapper;n.trigger("deletingFiles"),e.ajax({type:"POST",url:"/deleteFiles",contentType:"application/json",data:JSON.stringify({files:a}),success:function(){n.trigger("filesDeleted")},error:function(e){n.trigger("filesDeleted",[e])}})}function i(i,o){var r=e(i),l=o&&o.fileUploading,d=o&&o.filesUploaded,f=o&&o.gettingFiles,p=o&&o.gotFiles,s=o&&o.deletingFiles,u=o&&o.filesDeleted;l&&r.off("fileUploading").on("fileUploading",l),d&&r.off("filesUploaded").on("filesUploaded",d),f&&r.off("gettingFiles").on("gettingFiles",f),p&&r.off("gotFiles").on("gotFiles",p),s&&r.off("deletingFiles").on("deletingFiles",s),u&&r.off("filesDeleted").on("filesDeleted",u),r.off("uploadFiles").on("uploadFiles",{wrapper:r},a),r.off("getFiles").on("getFiles",{wrapper:r},t),r.off("deleteFiles").on("deleteFiles",{wrapper:r},n)}e.fn.s3=function(e){return this.each(function(t,a){i(a,e)})}}(jQuery.noConflict()),void function(e){function t(e){return e>1073741824?Math.ceil(e/1024/1024/1024)+"gb":e>1048576?Math.ceil(e/1024/1024)+"mb":e>1024?Math.ceil(e/1024)+"kb":e+"b"}function a(e){var a=t(e.Size),n=e.Key,i=n.replace("-thumb2",""),o="\n\t\t\t<div class='file-manager--image' duck-image-value=\""+i+'" title="'+i+'">\n\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col-xs-4">\n\t\t\t\t\t\t<img class="image--content" src="https://s3-us-west-2.amazonaws.com/stellaroute/'+n+'" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="col-xs-8">\n\t\t\t\t\t\t<h3 class="image--name">'+n.split("/")[n.split("/").length-1].replace("-thumb2","")+'</h3>\n\t\t\t\t\t\t<h4 class="image--size">'+(a||"unknown")+"</h4>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t";return o}function n(e){return function(t){t.stopPropagation(),e.attr("disabled",!0).html('<i class="fa fa-spinner fa-spin"></i> Uploading...')}}function i(e,t,a){return function(n,i){return n.stopPropagation(),a.toggleClass("hidden"),i?void e.text("Sorry, something went wrong uploading your image."):void t.trigger("getFiles",[{folder:t.prop("currentDirectory")}])}}function o(e){e.stopPropagation();var t=e.data.content,a=e.data.deleteStartButton;t.html('<div class="p-Xl ta-C js-waiting"><i class="fa fa-spinner fa-spin"></div>'),a.prop("disabled",!0)}function r(t,n,i){var o=e('[data-file-manager="current-directory"]');return function(e,t,r){if(t)return void n.text("Sorry, something went wrong getting the images.");var l=r.files||[],d=r.folder;i.prop("uploadFilePath",d||""),o.text(d||"Root"),n.html("");var f=l.filter(function(e){return e.Key.indexOf("-thumb2.")>-1}).sort(function(e,t){return e.LastModified>t.LastModified?-1:e.LastModified<t.LastModified?1:0});f.length?f.forEach(function(e){n.append(a(e))}):n.text("There are no files in this folder, you can upload some or check one of it's sub-folders."),n.closest('[data-function*="scroll"]').trigger("initScroll")}}function l(t,a){var l=e(t),d=l.find('[data-file-manager="content"]'),f=l.find('[data-file-manager="search"]'),p=l.find('[data-file-manager="delete-start"]'),s=l.find('[data-file-manager="delete-prompt"]'),u=l.find('[data-file-manager="delete"]'),c=l.find('[data-file-manager="delete-cancel"]'),g=s.find(".js-grammar"),v=l.find('[data-file-manager="uploader"]'),m=l.find('[data-file-manager="upload"]'),h=l.find('[data-uploader="upload"]'),y=l.find('[data-file-manager="directory"]'),F=a&&a.rootDirectory;f.on("input",function(t){t.stopPropagation(),t.preventDefault();var a=d.find(".file-manager--image"),n=f.val().toLowerCase();a.each(function(t,a){var i=e(a),o=i.attr("duck-image-value").toLowerCase();o.indexOf(n)===-1?i.addClass("hidden"):i.removeClass("hidden")})}),y.on("gettingFiles",{content:d,deleteStartButton:p},o),y.on("deletingFiles",{content:d,deleteStartButton:p},o),y.on("gotFiles",r(l,d,v)),y.directory(F),v.on("fileUploading",n(h)),v.on("filesUploaded",i(d,y,v)),m.on("click",function(e){e.stopPropagation(),e.preventDefault(),v.toggleClass("hidden")}),v.uploader(),d.on("click",".file-manager--image",function(t){t.stopPropagation(),t.preventDefault();var a=e(t.currentTarget);a.toggleClass("file-manager--image__active"),d.find(".file-manager--image__active").length&&p.prop("disabled",!1)}),p.add(c).on("click",function(e){e.stopPropagation(),e.preventDefault(),d.find(".file-manager--image__active").length>1?g.text("these"):g.text("this"),s.toggleClass("hidden")}),u.on("click",function(t){t.stopPropagation(),t.preventDefault();var a=[];d.find(".file-manager--image__active").each(function(t,n){var i=e(n).attr("duck-image-value"),o=i.split(".")[0],r=i.split(".")[1],l=["large","medium","small","thumb1","thumb2"];l.forEach(function(e){a.push({Key:o+"-"+e+"."+r})})}),u.prop("disabled",!0).text("Deleting").prepend('<i class="fa fa-spin fa-spinner" aria-hidden="true"></i> '),y.trigger("deleteFiles",[a])}),y.on("filesDeleted",function(e){e.stopPropagation(),s.addClass("hidden"),u.prop("disabled",!1).text("Delete")}),l.prop("fileManagerInitiated",!0)}e.fn.fileManager=function(e){return this.each(function(t,a){l(a,e)})},e(function(){e('[data-function*="file-manager"').fileManager()})}(jQuery.noConflict()),void function(e){function t(e,t){return function(a){return a.stopPropagation(),a.preventDefault(),t?void e.trigger("filesAdded",[t[0].files]):void e.trigger("filesAdded",[a.originalEvent.dataTransfer.files])}}function a(t,a){return function(n){n.stopPropagation(),n.preventDefault();var i=e(n.target).closest("li"),o=i.attr("data-file-name"),r=t.prop("filesToUpload")||[];r.forEach(function(e,t){if(e.name===o)return void r.splice(t,1)}),i.detach(),0===r.length&&a.prop("disabled",!0),t.prop("filesToUpload",r)}}function n(t,a){t.stopPropagation();for(var n=t.data.wrapper,i=t.data.filesList,o=t.data.uploadButton,r=n.prop("filesToUpload")||[],l=function(t,n){var l=a[t],d=i.find("li").filter(function(t,a){return e(a).attr("data-file-name")===l.name}).length>0;return d?{v:void 0}:(r.push(l),i.append("<li data-file-name='"+l.name+"'>"+l.name+"<button class='uploader--delete' data-uploader='delete'><i class='fa fa-times' aria-hidden='true'></i><span class='sr-only'>Remove File From Upload List</i></button></li>"),void o.prop("disabled",!1))},d=0,f=a.length;d<f;d++){var p=l(d,f);if("object"===("undefined"==typeof p?"undefined":_typeof(p)))return p.v}n.prop("filesToUpload",r)}function i(e){var t=e.data.wrapper,a=e.data.filesList,n=e.data.uploadButton;t.prop("filesToUpload",[]),a.empty(),n.text("Upload")}function o(o){var r=e(o),l=r.find('[data-uploader="file-drop"]'),d=r.find('[data-uploader="files"]'),f=r.find('[data-uploader="upload"]'),p=r.find('[data-uploader="cancel"]'),s=e('<input type="file" multiple="true">');r.on("filesAdded",{wrapper:r,filesList:d,uploadButton:f},n),p.on("click",function(e){e.stopPropagation(),e.preventDefault(),d.empty(),r.prop("filesToUpload",[]),f.prop("disabled",!0),r.toggleClass("hidden")}),d.on("click",'[data-uploader="delete"]',a(r,f)),l.on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),l.addClass(".uploader--file-drop__active")}),l.on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),l.removeClass(".uploader--file-drop__active")}),l.on("dragover",function(e){e.stopPropagation(),e.preventDefault();var t=void 0;try{t=e.originalEvent.dataTransfer.effectAllowed}catch(e){t=null}e.originalEvent.dataTransfer.dropEffect="move"===t||"linkMove"===t?"move":"copy"}),l.on("drop",t(r)),l.on("click",function(e){e.stopPropagation(),e.preventDefault(),s.click()}),s.on("change",t(r,s)),f.on("click",function(e){e.stopPropagation(),e.preventDefault(),r.trigger("uploadFiles",[r.prop("filesToUpload")])}),r.on("filesAdded",{wrapper:r,filesList:d,uploadButton:f},n),r.on("filesUploaded",{wrapper:r,filesList:d,uploadButton:f},i),r.s3()}e.fn.uploader=function(e){return this.each(function(t,a){o(a,e)})}}(jQuery.noConflict()),void function(e){function t(t){t.stopPropagation(),t.preventDefault();var a=t.data.wrapper,n=e(t.target),i=n.find("> i"),o=i.hasClass("fa-folder-open"),r=n.attr("data-prefix");if(o&&r===a.prop("currentDirectory"))return n.find("> i").removeClass("fa-folder-open").addClass("fa-folder"),void n.find("> ul").slideUp("270");var l={folder:r,files:n.prop("files"),subFolders:n.prop("subFolders")};a.trigger("getFiles",[l])}function a(e,t,a){if(!t){var n=e.data.wrapper,i=a.folder,o=a.subFolders,r=n.find('[data-prefix="'+i+'"]');r.prop("files",a.files),r.prop("subFolders",o),n.prop("currentDirectory",i),n.trigger("addFolders",[i,o])}}function n(e,t){if(e.stopPropagation(),!t){var a=e.data.wrapper,n=a.prop("currentDirectory");a.prop("currentDirectory",""),a.trigger("getFiles",{folder:n})}}function i(t,a){var n=e("<li/>",{"data-prefix":a?""+(t||"")+a+"/":"",text:" "+(a||"/ (root)")}),i=e("<i/>",{class:"fa fa-folder","aria-hidden":"true"});return n.prepend(i),n.append(e("<ul/>",{style:"display: none;"})),n}function o(t,a,n){t.stopPropagation();var o=t.data.wrapper,r=o.find('[data-prefix="'+(a||"")+'"]'),l=r.find("> ul");if(r.find("> i").removeClass("fa-folder").addClass("fa-folder-open"),n.forEach(function(e){0===l.find('> [data-prefix="'+(a||"")+e+'/"]').length&&l.append(i(a,e))}),0===l.find("> [data-directory]").length){var d=e("<i/>",{class:"fa fa-plus","aria-hidden":"true"}),f=e("<button/>",{text:" New Folder"}),p=e("<li/>",{"data-directory":"new-folder"});f.prepend(d),p.append(f),l.append(p)}l.slideDown("270")}function r(e){e.stopPropagation(),e.preventDefault();var t=e.data.wrapper,a=e.data.input,n=e.data.button,i=e.data.listItem,o=a.val();o?(i.remove(),t.trigger("addFolders",[e.data.prefix,[o]])):(a.remove(),n.removeClass("hidden"))}function l(t){t.stopPropagation(),t.preventDefault();var a=t.data.wrapper,n=e(t.target),i=n.parent();i.append(e("<input/>"));var o=i.find("input"),l=i.closest("[data-prefix]").attr("data-prefix");n.addClass("hidden"),o.focus(),o.on("blur",{wrapper:a,input:o,button:n,listItem:i,prefix:l},r)}function d(r,d){var f=e(r);f.find("> ul").append(i(null,d)),f.on("gotFiles",{wrapper:f},a),f.on("filesDeleted",{wrapper:f},n),f.on("addFolders",{wrapper:f},o),f.on("click","[data-prefix]",{wrapper:f},t),f.on("click",'[data-directory="new-folder"] button',{wrapper:f},l),f.s3(),f.trigger("getFiles",{folder:d||""})}e.fn.directory=function(e){return this.each(function(t,a){d(a,e)})}}(jQuery.noConflict());
//# sourceMappingURL=fileManager.min.js.map
