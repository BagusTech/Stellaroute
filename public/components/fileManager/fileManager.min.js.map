{"version":3,"sources":["components/fileManager/fileManager.js"],"names":["$","getRootDirectory","$wrapper","ajax","type","url","success","prop","data","trigger","getFiles","e","options","wrapper","dataType","err","uploadFiles","filesToUpload","files","FormData","i","length","formData","file","name","append","contentType","filesToDelete","JSON","stringify","s3","off","on","deleteFiles","fn","jQuery","noConflict","getFileSize","initFileManager","size","Math","ceil","image","imageSize","Size","key","Key","fileName","buildImage","date","split","replace","$uploaderSubmit","img","fileUploading","stopPropagation","attr","html","filesUploaded","$content","$directory","$uploader","toggleClass","folder","changingFiles","content","$deleteStartButton","deleteStartButton","text","$sort","folderPath","indexOf","$currentDirectory","join","images","filter","sort","a","b","LastModified","removeClass","find","addClass","preventDefault","val","$files","$file","toLowerCase","sortFiles","aDate","Date","sortBy","direction","bDate","$b","$a","bName","aName","selectFile","$targetFile","fileManager","$search","$deletePrompt","$deleteButton","$deleteGrammar","$sortDirection","$uploaderStart","effect","originalEvent","dataTransfer","effectAllowed","dropEffect","$target","search","searchFiles","$activeSort","target","hasClass","sortDirection","reverseDirection","directory","gotFiles","uploader","add","currentTarget","$deleteCancelButton","fileSizes","push","each","fileType","item","prepend","forEach","$fileManagers","addFileToUploadQueue","$uploadButton","splice","closest","detach","duplicateFile","$filesList","uploadButton","j","v","_ret","_loop","_typeof","filesList","$cancelButton","$fileDrop","filesAdded","$filesInput","deleteFileFromQueue","click","index","isOpen","$icon","$folder","subFolders","filesDeleted","data-prefix","parentDirectory","$folderIcon","class","aria-hidden","makeFolder","style","folders","$parentDirectory","$parentDirectorySubFoldersList","$addIcon","data-directory","$addButton","$addListItem","slideDown","handleInput","$input","input","button","listItem","$listItem","$button","prefix","remove","makeNewFolder","parent","evt","keyCode","which","blur","addFolders","rootDirectory"],"mappings":"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","file":"fileManager.min.js","sourcesContent":["/* global jQuery */\r\n\r\nvoid function initS3($) {\r\n\t'use strict';\r\n\r\n\tfunction getRootDirectory($wrapper) {\r\n\t\t$.ajax({\r\n\t\t\ttype: 'GET',\r\n\t\t\turl: '/getRootDirectory',\r\n\t\t\tsuccess: (data) => {\r\n\t\t\t\t$wrapper.prop('rootDirectory', data);\r\n\t\t\t\t$wrapper.trigger('s3Initialized');\r\n\t\t\t},\r\n\t\t})\r\n\t}\r\n\r\n\tfunction getFiles(e, options) {\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\r\n\t\t$wrapper.trigger('gettingFiles');\r\n\r\n\t\tif(options && options.files) {\r\n\t\t\t$wrapper.trigger('gotFiles', [null, options])\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$.ajax({\r\n\t\t\ttype: 'GET',\r\n\t\t\turl: '/getFiles',\r\n\t\t\tdataType: 'json',\r\n\t\t\tcontentType: 'application/json',\r\n\t\t\tdata: options || {},\r\n\t\t\tsuccess: (data) => {\r\n\t\t\t\t$wrapper.trigger('gotFiles', [null, data])\r\n\t\t\t},\r\n\t\t\terror: (err) => {\r\n\t\t\t\t$wrapper.trigger('gotFiles', [err])\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tfunction uploadFiles(e, filesToUpload) {\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\t\tconst files = filesToUpload;\r\n\r\n\t\tif (files.length > 0){\r\n\t\t\t$wrapper.trigger('fileUploading');\r\n\t\t\t// create a FormData object which will be sent as the data payload in the\r\n\t\t\t// AJAX request\r\n\t\t\tconst formData = new FormData();\r\n\r\n\t\t\t// loop through all the selected files and add them to the formData object\r\n\t\t\tfor (let i = 0; i < files.length; i++) {\r\n\t\t\t\tconst file = files[i];\r\n\r\n\t\t\t\t// add the files to formData object for the data payload\r\n\t\t\t\tformData.append('files', file, file.name);\r\n\t\t\t}\r\n\r\n\t\t\tformData.append('filePath', $wrapper.prop('uploadFilePath'))\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: '/upload',\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\tdata: formData,\r\n\t\t\t\tprocessData: false,\r\n\t\t\t\tcontentType: false,\r\n\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t$wrapper.trigger('filesUploaded');\r\n\t\t\t\t},\r\n\t\t\t\terror: (err) => {\r\n\t\t\t\t\t$wrapper.trigger('filesUploaded', [err]);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t$wrapper.trigger('fileUploading', [true]);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction deleteFiles(e, filesToDelete) {\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\r\n\t\t$wrapper.trigger('deletingFiles');\r\n\r\n\t\t$.ajax({\r\n\t\t\ttype: 'POST',\r\n\t\t\turl: '/deleteFiles',\r\n\t\t\tcontentType: 'application/json',\r\n\t\t\tdata: JSON.stringify({files: filesToDelete}),\r\n\t\t\tsuccess: () => {\r\n\t\t\t\t$wrapper.trigger('filesDeleted');\r\n\t\t\t},\r\n\t\t\terror: (err) => {\r\n\t\t\t\t$wrapper.trigger('filesDeleted', [err]);\r\n\t\t\t},\r\n\t\t})\r\n\t}\r\n\r\n\tfunction s3(wrapper) {\r\n\t\tconst $wrapper = $(wrapper);\r\n\r\n\t\t$wrapper.off('uploadFiles').on('uploadFiles', {wrapper: $wrapper}, uploadFiles);\r\n\t\t$wrapper.off('getFiles').on('getFiles', {wrapper: $wrapper}, getFiles);\r\n\t\t$wrapper.off('deleteFiles').on('deleteFiles', {wrapper: $wrapper}, deleteFiles);\r\n\t\t\r\n\t\tgetRootDirectory($wrapper);\r\n\t}\r\n\r\n\t$.fn.s3 = function init() {\r\n\t\treturn this.each((index, wrapper) => {\r\n\t\t\ts3(wrapper);\r\n\t\t});\r\n\t}\r\n}(jQuery.noConflict());\r\n\r\n\r\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //\r\n// ~~~~~~~~ file manager ~~~~~~~~ //\r\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //\r\nvoid function initFileManager($) {\r\n\t'use strict';\r\n\r\n\tfunction getFileSize(size) {\r\n\t\tif (size > 1073741824) {\r\n\t\t\treturn `${Math.ceil(size/1024/1024/1024)}gb`;\r\n\t\t} else if (size > 1048576) {\r\n\t\t\treturn `${Math.ceil(size/1024/1024)}mb`;\r\n\t\t} else if (size > 1024) {\r\n\t\t\treturn `${Math.ceil(size/1024)}kb`;\r\n\t\t}\r\n\r\n\t\treturn `${size}b`;\r\n\t}\r\n\r\n\tfunction buildImage(image) {\r\n\t\tconst imageSize = getFileSize(image.Size);\r\n\t\tconst key = image.Key;\r\n\t\tconst fileName = key.replace('-thumb2', '');\r\n\t\tconst date = image.LastModified;\r\n\t\tconst img = `\r\n\t\t\t<div class='file-manager--image' title=\"${fileName}\" data-file-date=\"${date}\">\r\n\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t<div class=\"col-xs-4\">\r\n\t\t\t\t\t\t<img class=\"image--content\" src=\"https://s3-us-west-2.amazonaws.com/stellaroute/${key}\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"col-xs-8\">\r\n\t\t\t\t\t\t<h3 class=\"image--name\">${key.split('/')[key.split('/').length-1].replace('-thumb2', '')}</h3>\r\n\t\t\t\t\t\t<h4 class=\"image--size\">${imageSize || 'unknown'}</h4>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\r\n\t\treturn img;\r\n\t}\r\n\r\n\tfunction fileUploading($uploaderSubmit) {\r\n\t\treturn (e) => {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\t$uploaderSubmit.attr('disabled', true).html('<i class=\"fa fa-spinner fa-spin\"></i> Uploading...');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction filesUploaded($content, $directory, $uploader) {\r\n\t\treturn\t(e, err) => {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\t$uploader.toggleClass('hidden');\r\n\r\n\t\t\tif(err) {\r\n\t\t\t\t$content.text('Sorry, something went wrong uploading your image.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t$directory.trigger('getFiles', [{folder: $directory.prop('currentDirectory')}]);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction changingFiles(e) {\r\n\t\te.stopPropagation();\r\n\r\n\t\tconst $content = e.data.content;\r\n\t\tconst $deleteStartButton = e.data.deleteStartButton;\r\n\r\n\t\t$content.html('<div class=\"p-Xl ta-C js-waiting\"><i class=\"fa fa-spinner fa-spin\"></div>');\r\n\t\t$deleteStartButton.prop('disabled', true);\r\n\t}\r\n\r\n\tfunction gotFiles($wrapper, $content, $uploader, $sort) {\r\n\t\tconst $currentDirectory = $('[data-file-manager=\"current-directory\"]');\r\n\r\n\t\treturn (e, err, data) => {\r\n\t\t\tif (err) {\r\n\t\t\t\t$content.text('Sorry, something went wrong getting the images.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst files = data.files || [];\r\n\t\t\tconst folder = data.folder;\r\n\r\n\t\t\t//const marker = data.marker;\r\n\t\t\t//const nextMarker = data.nextMarker;\r\n\r\n\t\t\t$uploader.prop('uploadFilePath', folder || '');\r\n\t\t\tif(folder) {\r\n\t\t\t\tconst folderPath = folder.split('/');\r\n\r\n\t\t\t\tfolderPath[0] = 'My Files';\r\n\t\t\t\t$currentDirectory.text(folderPath.join('/'));\r\n\t\t\t} else {\r\n\t\t\t\t$currentDirectory.text('Root')\t;\r\n\t\t\t}\r\n\r\n\t\t\t$content.html('');\r\n\r\n\t\t\tconst images = files.filter((img) => img.Key.indexOf('-thumb2.') > -1).sort((a, b) => {\r\n\t\t\t\tif(a.LastModified > b.LastModified) {return -1}\r\n\t\t\t\tif(a.LastModified < b.LastModified) {return 1}\r\n\t\t\t\treturn 0;\r\n\t\t\t});\r\n\r\n\t\t\t\r\n\r\n\t\t\tif(!images.length) {\r\n\t\t\t\t$sort.addClass('hidden');\r\n\t\t\t\t$content.text('There are no files in this folder, you can upload some or check one of it\\'s sub-folders.');\r\n\t\t\t} else {\r\n\t\t\t\t$sort.removeClass('hidden').find('.active').removeClass('active');\r\n\t\t\t\t$sort.find('[data-sort=\"date\"]').addClass('active');\r\n\t\t\t\timages.forEach((image) => {\r\n\t\t\t\t\t$content.append(buildImage(image))\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t$content\r\n\t\t\t\t.closest('[data-function*=\"scroll\"]')\r\n\t\t\t\t.trigger('initScroll');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction searchFiles(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tconst $search = e.data.search;\r\n\t\tconst $content = e.data.content;\r\n\t\tconst $files = $content.find('.file-manager--image');\r\n\t\tconst val = $search.val().toLowerCase();\r\n\r\n\t\t$files.each((i, file) => {\r\n\t\t\tconst $file = $(file);\r\n\t\t\tconst fileName = $file.attr('title').toLowerCase();\r\n\r\n\t\t\tif(fileName.indexOf(val) === -1) {\r\n\t\t\t\t$file.addClass('hidden');\r\n\t\t\t} else {\r\n\t\t\t\t$file.removeClass('hidden');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction sortFiles($content, $files, sortBy, direction) {\r\n\t\t$content.empty();\r\n\t\t$files.sort((a, b) => {\r\n\t\t\tconst $a = $(a);\r\n\t\t\tconst $b = $(b);\r\n\r\n\t\t\tif (sortBy === 'date') {\r\n\t\t\t\tconst aDate = new Date($a.attr('data-file-date'));\r\n\t\t\t\tconst bDate = new Date($b.attr('data-file-date'));\r\n\r\n\t\t\t\tif(aDate > bDate) {\r\n\t\t\t\t\treturn direction === 'asc' ? 1 : -1\r\n\t\t\t\t} else if (aDate < bDate) {\r\n\t\t\t\t\treturn direction === 'asc' ? -1 : 1\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn 0\r\n\t\t\t}\r\n\r\n\t\t\tconst aName = $a.attr('title').toLowerCase();\r\n\t\t\tconst bName = $b.attr('title').toLowerCase();\r\n\r\n\t\t\tif(aName > bName) {\r\n\t\t\t\treturn direction === 'asc' ? 1 : -1\r\n\t\t\t} else if (aName < bName) {\r\n\t\t\t\treturn direction === 'asc' ? -1 : 1\r\n\t\t\t}\r\n\r\n\t\t\treturn 0\r\n\t\t});\r\n\t\t$content.append($files);\r\n\t}\r\n\r\n\tfunction selectFile(e, $targetFile) {\r\n\t\te.stopPropagation();\r\n\r\n\t\tconst $content = e.data.content;\r\n\t\tconst $deleteStartButton = e.data.deleteStartButton;\r\n\r\n\t\t$targetFile.addClass('file-manager--image__active');\r\n\r\n\t\tif($content.find('.file-manager--image__active').length) {\r\n\t\t\t$deleteStartButton.prop('disabled', false);\r\n\t\t} else {\r\n\t\t\t$deleteStartButton.prop('disabled', true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction fileManager(wrapper) {\r\n\t\tconst $wrapper = $(wrapper);\r\n\r\n\t\tif($wrapper.prop('fileManagerInitialized')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst $content = $wrapper.find('[data-file-manager=\"content\"]'); // where all the files are shown\r\n\t\tconst $search = $wrapper.find('[data-file-manager=\"search\"]');\r\n\r\n\t\tconst $sort = $wrapper.find('[data-file-manager=\"sort\"]');\r\n\t\tconst $sortDirection = $sort.find('[data-sort-direction]');\r\n\t\t\r\n\t\tconst $deleteStartButton = $wrapper.find('[data-file-manager=\"delete-start\"]'); // button to open delete prompt\r\n\t\tconst $deletePrompt = $wrapper.find('[data-file-manager=\"delete-prompt\"]'); // prompt to confirm delete\r\n\t\tconst $deleteButton = $wrapper.find('[data-file-manager=\"delete\"]'); // button to delete selected files\r\n\t\tconst $deleteCancelButton = $wrapper.find('[data-file-manager=\"delete-cancel\"]'); // cancel delete\r\n\t\tconst $deleteGrammar = $deletePrompt.find('.js-grammar');\r\n\t\t\r\n\t\tconst $uploader = $wrapper.find('[data-file-manager=\"uploader\"]'); // container for uploader\r\n\t\tconst $uploaderStart = $wrapper.find('[data-file-manager=\"upload\"]'); // button to start the upload\r\n\t\tconst $uploaderSubmit = $wrapper.find('[data-uploader=\"upload\"]'); // button to submit the upload\r\n\t\t\r\n\t\tconst $directory = $wrapper.find('[data-file-manager=\"directory\"]'); // where the file structure is shown\r\n\r\n\t\t$content.on('dragenter', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$content.addClass('file-manager--content__active');\r\n\t\t});\r\n\r\n\t\t$content.on('dragleave', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$content.removeClass('file-manager--content__active');\r\n\t\t});\r\n\r\n\t\t$content.on('dragover', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tlet effect;\r\n\r\n\t\t\ttry {\r\n\t\t\t\teffect = e.originalEvent.dataTransfer.effectAllowed;\r\n\t\t\t} catch (_error) {\r\n\t\t\t\teffect = null;\r\n\t\t\t}\r\n\r\n\t\t\te.originalEvent.dataTransfer.dropEffect = effect === 'move' || effect === 'linkMove' ? 'move' : 'copy';\r\n\t\t});\r\n\r\n\t\t$content.on('drop', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$uploader.toggleClass('hidden');\r\n\t\t\t$uploader.trigger('filesAdded', [e.originalEvent.dataTransfer.files]);\r\n\t\t\t$content.removeClass('file-manager--content__active');\r\n\t\t})\r\n\r\n\t\t$search.on('input', {content: $content, search: $search}, searchFiles);\r\n\r\n\t\t$sort.on('click', 'button', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tconst $target = $(e.target);\r\n\t\t\tconst sortBy = $target.attr('data-sort');\r\n\t\t\tconst sortDirection = $sortDirection.attr('data-sort-direction');\r\n\t\t\tconst $activeSort = $sort.find('.active');\r\n\t\t\tconst reverseDirection = sortDirection === 'asc' ? 'desc' : 'asc';\r\n\t\t\tconst $files = $content.find('.file-manager--image');\r\n\r\n\t\t\tif (!sortBy) {\r\n\t\t\t\t$sortDirection.attr('data-sort-direction', reverseDirection);\r\n\t\t\t\tsortFiles($content, $files, $activeSort.attr('data-sort'), reverseDirection);\r\n\t\t\t} else if ($target.hasClass('active')){\r\n\t\t\t\t$sortDirection.attr('data-sort-direction', reverseDirection);\r\n\t\t\t\tsortFiles($content, $files, sortBy, reverseDirection);\r\n\t\t\t} else {\r\n\t\t\t\t$activeSort.removeClass('active');\r\n\t\t\t\t$target.addClass('active');\r\n\t\t\t\tsortFiles($content, $files, sortBy, sortDirection);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t$directory.on('gettingFiles', {content: $content, deleteStartButton: $deleteStartButton}, changingFiles);\r\n\t\t$directory.on('deletingFiles', {content: $content, deleteStartButton: $deleteStartButton}, changingFiles);\r\n\t\t$directory.on('gotFiles', gotFiles($wrapper, $content, $uploader, $sort));\r\n\t\t$directory.directory();\r\n\r\n\t\t$uploader.on('fileUploading', fileUploading($uploaderSubmit));\r\n\t\t$uploader.on('filesUploaded', filesUploaded($content, $directory, $uploader));\r\n\t\t$uploaderStart.on('click', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$uploader.toggleClass('hidden');\r\n\t\t});\r\n\t\t$uploader.uploader();\r\n\r\n\t\t$wrapper.on('selectFile', {content: $content, deleteStartButton: $deleteStartButton}, selectFile);\r\n\t\t\r\n\t\t$content.on('click', '.file-manager--image', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$wrapper.trigger('selectFile', [$(e.currentTarget), $content.find('.file-manager--image__active')]);\r\n\t\t});\r\n\r\n\t\t$deleteStartButton.add($deleteCancelButton).on('click', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif($content.find('.file-manager--image__active').length > 1) {\r\n\t\t\t\t$deleteGrammar.text('these')\r\n\t\t\t} else {\r\n\t\t\t\t$deleteGrammar.text('this')\r\n\t\t\t}\r\n\t\t\t$deletePrompt.toggleClass('hidden');\r\n\t\t});\r\n\r\n\t\t$deleteButton.on('click', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tconst files = [];\r\n\t\t\t$content.find('.file-manager--image__active').each((i, item) => {\r\n\t\t\t\tconst key = $(item).attr('title'); // \"images/my-picture-name.jpg\"\r\n\t\t\t\tconst fileName = key.split('.')[0]; // \"images/my-picture-name\"\r\n\t\t\t\tconst fileType = key.split('.')[1]; // \"jpg\"\r\n\t\t\t\tconst fileSizes = ['large', 'medium', 'small', 'thumb1', 'thumb2'];\r\n\r\n\t\t\t\tfileSizes.forEach((size) => {\r\n\t\t\t\t\tfiles.push({Key: `${fileName}-${size}.${fileType}`});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t$deleteButton.prop('disabled', true).text('Deleting').prepend('<i class=\"fa fa-spin fa-spinner\" aria-hidden=\"true\"></i> ')\r\n\t\t\t$directory.trigger('deleteFiles', [files]);\r\n\t\t});\r\n\r\n\t\t$directory.on('filesDeleted', (e) => {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\t$deletePrompt.addClass('hidden');\r\n\t\t\t$deleteButton.prop('disabled', false).text('Delete')\r\n\t\t})\r\n\t\t\r\n\t\t$wrapper.prop('fileManagerInitialized', true);\r\n\t}\r\n\r\n\t$.fn.fileManager = function init() {\r\n\t\treturn this.each((index, wrapper) => { fileManager(wrapper); });\r\n\t}\r\n\r\n\t// run after dom has loaded\r\n\t$(() => {\r\n\t\tconst $fileManagers = $('[data-function*=\"file-manager\"');\r\n\r\n\t\tif($fileManagers.length) {\r\n\t\t\t$fileManagers.fileManager();\r\n\t\t}\r\n\t});\r\n}(jQuery.noConflict());\r\n\r\n\r\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //\r\n// ~~~~~~~~~~ uploader ~~~~~~~~~~ //\r\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //\r\nvoid function initUploader($) {\r\n\t'use strict';\r\n\r\n\tfunction addFileToUploadQueue(e, files) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\t$(e.data.wrapper).trigger('filesAdded', [files]);\r\n\t}\r\n\r\n\tfunction deleteFileFromQueue($wrapper, $uploadButton) {\r\n\t\treturn (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tconst $file = $(e.target).closest('li');\r\n\t\t\tconst fileName = $file.attr('data-file-name');\r\n\t\t\tconst filesToUpload = $wrapper.prop('filesToUpload') || [];\r\n\r\n\t\t\tfilesToUpload.forEach((file, i) => {\r\n\t\t\t\tif(file.name === fileName) {\r\n\t\t\t\t\tfilesToUpload.splice(i, 1);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$file.detach();\r\n\r\n\t\t\tif(filesToUpload.length === 0) {\r\n\t\t\t\t$uploadButton.prop('disabled', true);\r\n\t\t\t}\r\n\r\n\t\t\t$wrapper.prop('filesToUpload', filesToUpload)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction filesAdded(e, files) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\t\tconst $filesList = e.data.filesList;\r\n\t\tconst $uploadButton = e.data.uploadButton;\r\n\t\tconst filesToUpload = $wrapper.prop('filesToUpload') || [];\r\n\r\n\t\tfor (let i = 0, length = files.length; i < length; i++) {\r\n\t\t\tconst file = files[i];\r\n\t\t\tconst duplicateFile = $filesList.find('li').filter((j, item) => $(item).attr('data-file-name') === file.name).length > 0;\r\n\r\n\t\t\tif(duplicateFile) {\r\n\t\t\t\treturn; // ignore duplicate files\r\n\t\t\t}\r\n\r\n\t\t\tfilesToUpload.push(file);\r\n\t\t\t$filesList.append(`<li data-file-name='${file.name}'><button class='uploader--delete' data-uploader='delete'><i class='fa fa-times' aria-hidden='true'></i><span class='sr-only'>Remove File From Upload List</i></button>${file.name}</li>`);\r\n\t\t\t$uploadButton.prop('disabled', false);\r\n\t\t}\r\n\r\n\t\t$wrapper.prop('filesToUpload', filesToUpload);\r\n\t}\r\n\r\n\tfunction filesUploaded(e) {\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\t\tconst $filesList = e.data.filesList;\r\n\t\tconst $uploadButton = e.data.uploadButton;\r\n\r\n\t\t$wrapper.prop('filesToUpload', []);\r\n\t\t$filesList.empty();\r\n\t\t$uploadButton.text('Upload');\r\n\t}\r\n\r\n\tfunction uploader(wrapper) {\r\n\t\tconst $wrapper = $(wrapper);\r\n\t\tif($wrapper.prop('uploaderInitialized')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst $fileDrop = $wrapper.find('[data-uploader=\"file-drop\"]'); // area where files can be dragged and dropped to for upload\r\n\t\tconst $filesList = $wrapper.find('[data-uploader=\"files\"]'); // list of files to be uploaded\r\n\t\tconst $uploadButton = $wrapper.find('[data-uploader=\"upload\"]'); // button to do upload\r\n\t\tconst $cancelButton = $wrapper.find('[data-uploader=\"cancel\"]'); // button to cancel the upload\r\n\t\tconst $filesInput = $('<input type=\"file\" multiple=\"true\">'); // created in the dom but never put on the page, used so user can add file by clicking on file drop location\t\t\r\n\r\n\t\t$wrapper.on('filesAdded', {wrapper: $wrapper, filesList: $filesList, uploadButton: $uploadButton}, filesAdded);\r\n\r\n\t\t$cancelButton.on('click', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$filesList.empty();\r\n\t\t\t$wrapper.prop('filesToUpload', []);\r\n\t\t\t$uploadButton.prop('disabled', true);\r\n\t\t\t$wrapper.toggleClass('hidden');\r\n\t\t});\r\n\r\n\t\t$filesList.on('click', '[data-uploader=\"delete\"]', deleteFileFromQueue($wrapper, $uploadButton));\r\n\r\n\t\t$fileDrop.on('dragenter', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$fileDrop.addClass('uploader--file-drop__active');\r\n\t\t});\r\n\r\n\t\t$fileDrop.on('dragleave', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$fileDrop.removeClass('uploader--file-drop__active');\r\n\t\t});\r\n\r\n\t\t$fileDrop.on('dragover', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tlet effect;\r\n\r\n\t\t\ttry {\r\n\t\t\t\teffect = e.originalEvent.dataTransfer.effectAllowed;\r\n\t\t\t} catch (_error) {\r\n\t\t\t\teffect = null;\r\n\t\t\t}\r\n\r\n\t\t\te.originalEvent.dataTransfer.dropEffect = effect === 'move' || effect === 'linkMove' ? 'move' : 'copy';\r\n\t\t});\r\n\r\n\t\t$fileDrop.on('drop', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$fileDrop.trigger('addFileToUploadQueue', [e.originalEvent.dataTransfer.files]);\r\n\t\t\t$fileDrop.removeClass('uploader--file-drop__active');\r\n\t\t});\r\n\t\t$fileDrop.on('addFileToUploadQueue', {wrapper: $wrapper}, addFileToUploadQueue);\r\n\r\n\t\t$fileDrop.on('click', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$filesInput.click();\r\n\t\t});\r\n\r\n\t\t$filesInput.on('change', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$fileDrop.trigger('addFileToUploadQueue', [$filesInput[0].files]);\r\n\t\t});\r\n\r\n\t\t$uploadButton.on('click', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$wrapper.trigger('uploadFiles', [$wrapper.prop('filesToUpload')]);\r\n\t\t});\r\n\r\n\t\t$wrapper.on('filesAdded', {wrapper: $wrapper, filesList: $filesList, uploadButton: $uploadButton}, filesAdded);\r\n\t\t$wrapper.on('filesUploaded', {wrapper: $wrapper, filesList: $filesList, uploadButton: $uploadButton}, filesUploaded)\r\n\t\t$wrapper.s3();\r\n\r\n\t\t$wrapper.prop('uploaderInitialized', true);\r\n\t}\r\n\r\n\t$.fn.uploader = function init(options) {\r\n\t\treturn this.each((index, wrapper) => {\r\n\t\t\tuploader(wrapper, options);\r\n\t\t});\r\n\t}\r\n}(jQuery.noConflict());\r\n\r\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //\r\n// ~~~~~~~~~~ directory ~~~~~~~~~ //\r\n// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ //\r\nvoid function initDirectory($) {\r\n\t'use strict';\r\n\r\n\tfunction getFiles(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\t\tconst $folder = $(e.target);\r\n\t\tconst $icon = $folder.find('> i');\r\n\t\tconst isOpen = $icon.hasClass('fa-folder-open')\r\n\t\tconst folder = $folder.attr('data-prefix');\r\n\r\n\t\tif(isOpen && folder === $wrapper.prop('currentDirectory')) {\r\n\t\t\t$folder.find('> i').removeClass('fa-folder-open').addClass('fa-folder');\r\n\t\t\t$folder.find('> ul').slideUp('270');\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst options = {\r\n\t\t\tfolder,\r\n\t\t\tfiles: $folder.prop('files'),\r\n\t\t\tsubFolders: $folder.prop('subFolders'),\r\n\t\t}\r\n\r\n\t\t$wrapper.off('click', getFiles);\r\n\t\t$wrapper.trigger('getFiles', [options]);\r\n\t}\r\n\r\n\tfunction gotFiles(e, err, data) {\r\n\t\tif(err) { return; }\r\n\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\t\tconst folder = data.folder;\r\n\t\tconst subFolders = data.subFolders;\r\n\t\tconst $folder = $wrapper.find(`[data-prefix=\"${folder}\"]`);\r\n\r\n\t\t$folder.prop('files', data.files);\r\n\t\t$folder.prop('subFolders', subFolders);\r\n\t\t$wrapper.prop('currentDirectory', folder);\r\n\t\t$wrapper.trigger('addFolders', [folder, subFolders]);\r\n\t\t$wrapper.on('click', '[data-prefix]', {wrapper: $wrapper}, getFiles);\r\n\t}\r\n\r\n\tfunction filesDeleted(e, err) {\r\n\t\te.stopPropagation();\r\n\r\n\t\tif(err) {return;}\r\n\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\t\tconst folder = $wrapper.prop('currentDirectory');\r\n\r\n\t\t$wrapper.prop('currentDirectory', '');\r\n\t\t$wrapper.trigger('getFiles', {folder});\r\n\r\n\t}\r\n\r\n\tfunction makeFolder(parentDirectory, folder, $wrapper) {\r\n\t\tconst $folder = $('<li/>', { // the base folder element\r\n\t\t\t'data-prefix': folder ? `${parentDirectory || ''}${folder}/` : '',\r\n\t\t\ttext: ` ${folder === $wrapper.prop('rootDirectory') ? 'My Files' : folder || 'My Files'}`,\r\n\t\t});\r\n\t\tconst $folderIcon = $('<i/>', {\r\n\t\t\t'class': 'fa fa-folder',\r\n\t\t\t'aria-hidden': 'true',\r\n\t\t});\r\n\r\n\t\t$folder.prepend($folderIcon);\r\n\r\n\t\t$folder.append($('<ul/>', {style: 'display: none;'})) // where the next set of sub folders will live\r\n\t\t\r\n\t\treturn $folder;\r\n\t}\r\n\r\n\tfunction addFolders(e, parentDirectory, folders) {\r\n\t\te.stopPropagation();\r\n\r\n\r\n\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\t\tconst $parentDirectory = $wrapper.find(`[data-prefix=\"${parentDirectory || ''}\"]`);\r\n\t\tconst $parentDirectorySubFoldersList = $parentDirectory.find('> ul');\r\n\r\n\t\t$parentDirectory.find('> i').removeClass('fa-folder').addClass('fa-folder-open');\r\n\r\n\t\tfolders.forEach((folder) => {\r\n\t\t\tif($parentDirectorySubFoldersList.find(`> [data-prefix=\"${parentDirectory || ''}${folder}/\"]`).length === 0) {\r\n\t\t\t\t$parentDirectorySubFoldersList.append(makeFolder(parentDirectory, folder, $wrapper));\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif($parentDirectorySubFoldersList.find('> [data-directory]').length === 0) {\r\n\t\t\tconst $addIcon = $('<i/>', {\r\n\t\t\t\t'class': 'fa fa-plus',\r\n\t\t\t\t'aria-hidden': 'true',\r\n\t\t\t});\r\n\t\t\tconst $addButton = $('<button/>', {text: ' New Folder'});\r\n\t\t\tconst $addListItem = $('<li/>', {'data-directory': 'new-folder'});\r\n\r\n\t\t\t$addButton.prepend($addIcon);\r\n\t\t\t$addListItem.append($addButton);\r\n\t\t\t$parentDirectorySubFoldersList.append($addListItem);\r\n\t\t}\r\n\r\n\t\t$parentDirectorySubFoldersList.slideDown('270');\r\n\t}\r\n\r\n\tfunction handleInput(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\t\tconst $input = e.data.input;\r\n\t\tconst $button = e.data.button;\r\n\t\tconst $listItem = e.data.listItem;\r\n\t\tconst val = $input.val();\r\n\r\n\t\tif(val) {\r\n\t\t\t$listItem.remove();\r\n\t\t\t$wrapper.trigger('addFolders', [e.data.prefix, [val]]);\r\n\t\t} else {\r\n\t\t\t$input.remove();\r\n\t\t\t$button.removeClass('hidden');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction makeNewFolder(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\t\tconst $button = $(e.target);\r\n\t\tconst $listItem = $button.parent();\r\n\t\t$listItem.append($('<input/>'));\r\n\t\tconst $input = $listItem.find('input');\r\n\t\tconst prefix = $listItem.closest('[data-prefix]').attr('data-prefix');\r\n\t\t\r\n\t\t$button.addClass('hidden');\r\n\t\t$input.focus();\r\n\r\n\t\t$input.on('blur', {wrapper: $wrapper, input: $input, button: $button, listItem: $listItem, prefix}, handleInput);\r\n\t\t$input.on('keypress', (evt) => {\r\n\t\t\tconst keyCode = evt.keyCode || evt.which;\r\n\r\n\t\t\tif (keyCode === 13){\r\n\t\t\t\t$input.blur();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction directory(wrapper) {\r\n\t\tconst $wrapper = $(wrapper);\r\n\r\n\t\tif($wrapper.prop('directoryInitialized')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$wrapper.on('gotFiles', {wrapper: $wrapper}, gotFiles);\r\n\t\t$wrapper.on('filesDeleted', {wrapper: $wrapper}, filesDeleted);\r\n\t\t$wrapper.on('addFolders', {wrapper: $wrapper}, addFolders);\r\n\t\t$wrapper.on('click', '[data-directory=\"new-folder\"] button', {wrapper: $wrapper}, makeNewFolder);\r\n\t\t$wrapper.on('s3Initialized', () => {\r\n\t\t\tconst rootDirectory = $wrapper.prop('rootDirectory');\r\n\r\n\r\n\t\t\t$wrapper.find('> ul').append(makeFolder(null, rootDirectory, $wrapper));\r\n\t\t\t$wrapper.trigger('getFiles', {folder: `${rootDirectory}/` || ''});\r\n\t\t});\r\n\t\t$wrapper.s3();\r\n\t\t$wrapper.prop('directoryInitialized', true)\r\n\t}\r\n\r\n\t$.fn.directory = function init() {\r\n\t\treturn this.each((index, wrapper) => {\r\n\t\t\tdirectory(wrapper);\r\n\t\t});\r\n\t}\r\n}(jQuery.noConflict());"]}