{"version":3,"sources":["controls/searchBar/searchBar.js"],"names":["$","search","e","_term","stopPropagation","data","input","$icon","icon","$input","resultsWrapper","results","$resultsWrapper","$results","val","term","toggleClass","trim","length","html","append","removeClass","ajax","type","url","contentType","JSON","success","$backdrop","guides","forEach","guide","i","$html","author","cardImage","replace","names","display","tagline","$tags","find","tag","country","$countries","closeSearch","err","startSearch","$wrapper","wrapper","setTimeout","trigger","hasClass","preventDefault","timeout","$close","$button","triggerSearch","searchBar","init","off","on","backdrop","jQuery","noConflict","this","each","index","initSearchBar"],"mappings":"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","file":"searchBar.min.js","sourcesContent":["/* global jQuery */\r\n\r\nvoid function _initSearchBar($){\r\n\t'use strict';\r\n\t\r\n\tfunction search(e, _term) {\r\n\t\te.stopPropagation();\r\n\r\n\t\tconst $input = e.data.input;\r\n\t\tconst $icon = e.data.icon;\r\n\t\tconst $resultsWrapper = e.data.resultsWrapper;\r\n\t\tconst $results = e.data.results;\r\n\t\tconst $backdrop = e.data.backdrop;\r\n\t\tconst term = _term || $input.val();\r\n\r\n\t\tif($icon.hasClass('fa-search')) {\r\n\t\t\t$icon.toggleClass('fa-search fa-spin fa-spinner');\r\n\t\t}\r\n\r\n\t\tif(!term || !term.trim() || term.trim().length < 3) {\r\n\t\t\t\r\n\t\t\t$results.html('')\r\n\t\t\t\t\t.append('<p>Sorry, you must have at least 3 letters before searching</p>');\r\n\t\t\t$resultsWrapper.removeClass('hidden')\r\n\t\t\t$icon.toggleClass('fa-search fa-spin fa-spinner');\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$.ajax({\r\n\t\t\ttype: 'POST',\r\n\t\t\turl: '/search',\r\n\t\t\tcontentType: 'application/json',\r\n\t\t\tdata: JSON.stringify({term}),\r\n\t\t\tsuccess: (guides) => {\r\n\t\t\t\t$backdrop.removeClass('hidden');\r\n\t\t\t\t$results.html('');\r\n\t\t\t\t$resultsWrapper.removeClass('hidden');\r\n\r\n\t\t\t\tif(!guides || !guides.length) {\r\n\t\t\t\t\t$results.append('<p>No results</p>');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tguides.forEach((guide, i) => {\r\n\t\t\t\t\t\tconst $html = $(`\r\n\t\t\t\t\t\t\t${i === 0 ? `<span class='f-L pl-Sm mt-XXs'>${guides.length} results</span>` : ''}\r\n\t\t\t\t\t\t\t<a class='search-results--result' href='/${guide.author}/${guide.url}'>\r\n\t\t\t\t\t\t\t\t<div class='w-25 f-L'>\r\n\t\t\t\t\t\t\t\t\t<img class='w-100' src='https://s3-us-west-2.amazonaws.com/stellaroute/${guide.cardImage.replace('.jpg', '-thumb1.jpg').replace('.jpeg', '-thumb1.jpeg')}' />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class='w-75 f-L plr-Sm pb-Sm ta-L fc-B'>\r\n\t\t\t\t\t\t\t\t\t<h2 class='mt-Sm'>${guide.names.display}</h2>\r\n\t\t\t\t\t\t\t\t\t<p class='fc-G__Dk lh-1 hidden-xs'>${guide.tagline || 'No Tagline Provided'}</p>\r\n\t\t\t\t\t\t\t\t\t<div class='js-countries fs-Sm'></div>\r\n\t\t\t\t\t\t\t\t\t<div class='js-tags fs-Sm hidden mt-Xs'></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t`);\r\n\r\n\t\t\t\t\t\tif(guide.countriesDisplay) {\r\n\t\t\t\t\t\t\tconst $countries = $html.find('.js-countries');\r\n\t\t\t\t\t\t\tguide.countriesDisplay.forEach((country) => {\r\n\t\t\t\t\t\t\t\t$countries.append(`<span class='fc-W bg-Gr p-XXs d-Ib'>${country}</span>`);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(guide.tags) {\r\n\t\t\t\t\t\t\tconst $tags = $html.find('.js-tags');\r\n\t\t\t\t\t\t\t$tags.removeClass('hidden');\r\n\t\t\t\t\t\t\tguide.tags.forEach((tag) => {\r\n\t\t\t\t\t\t\t\t$tags.append(`<span class='bw-Sm bs-S bc-G p-XXs d-Ib'>${tag}</span>`);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$results.append($html);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t$icon.toggleClass('fa-search fa-spin fa-spinner');\r\n\t\t\t},\r\n\t\t\terr: (err) => {\r\n\t\t\t\tthrow err;\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tfunction closeSearch(e) {\r\n\t\te.stopPropagation();\r\n\r\n\t\te.data.resultsWrapper.addClass('hidden');\r\n\t\te.data.backdrop.addClass('hidden');\r\n\t\te.data.input.val('');\r\n\t}\r\n\r\n\r\n\tfunction startSearch(e) {\r\n\t\te.stopPropagation();\r\n\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\t\tconst $icon = e.data.icon;\r\n\t\tconst $input = e.data.input;\r\n\r\n\t\tif($icon.hasClass('fa-search') && $input.val()) {\r\n\t\t\t$icon.toggleClass('fa-search fa-spin fa-spinner');\r\n\t\t}\r\n\r\n\t\tclearTimeout(e.data.timeout);\r\n\r\n\t\te.data.timeout = setTimeout(() => {\r\n\t\t\t$wrapper.trigger('duck.search', [$input.val()]);\r\n\t\t}, 1000)\r\n\t}\r\n\r\n\tfunction triggerSearch(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\te.data.wrapper.trigger('duck.search')\r\n\t}\r\n\r\n\tfunction initSearchBar(wrapper) {\r\n\t\tconst $wrapper = $(wrapper);\r\n\t\tconst $icon = $wrapper.find('.js-search-icon');\r\n\t\tconst $input = $wrapper.find('.js-search-input');\r\n\t\tconst $button = $wrapper.find('.js-search-button');\r\n\t\tconst $resultsWrapper = $wrapper.find('.js-search-results-wrapper');\r\n\t\tconst $results = $wrapper.find('.js-search-results');\r\n\t\tconst $close = $wrapper.find('.js-close-search');\r\n\t\tconst $backdrop = $wrapper.find('.js-seach-backdrop');\r\n\t\tlet timeout;\r\n\t\t\r\n\t\t$input.off('input', startSearch).on('input', {wrapper: $wrapper, icon: $icon, input: $input, timeout}, startSearch);\r\n\t\t$wrapper.off('duck.search', search).on('duck.search', {input: $input, icon: $icon, resultsWrapper: $resultsWrapper, results: $results, backdrop: $backdrop}, search);\r\n\t\t$close.off('click', closeSearch).on('click', {resultsWrapper: $resultsWrapper, backdrop: $backdrop, input: $input}, closeSearch);\r\n\t\t$button.off('click', triggerSearch).on('click', {wrapper: $wrapper}, triggerSearch)\r\n\t}\r\n\r\n\t$.fn.searchBar = function init() {\r\n\t\treturn this.each((index, wrapper) => initSearchBar(wrapper));\r\n\t}\r\n\r\n\t$(() => {$('.js-search-bar').searchBar()});\r\n}(jQuery.noConflict())"]}