{"version":3,"sources":["controls/searchBar/searchBar.js"],"names":["$","search","e","_term","stopPropagation","data","input","$icon","icon","$input","resultsWrapper","results","$resultsWrapper","$results","$backdrop","backdrop","term","toggleClass","trim","length","html","append","removeClass","ajax","type","url","contentType","JSON","success","$zIndex","css","guides","forEach","guide","i","$html","author","cardImage","replace","names","display","tagline","$tags","find","tag","country","$countries","closeSearch","err","addClass","$wrapper","wrapper","startSearch","setTimeout","trigger","hasClass","val","preventDefault","timeout","window","location","href","$close","on","$button","goToSearchPage","searchBar","off","zIndex","jQuery","noConflict","this","each","index","initSearchBar"],"mappings":"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","file":"searchBar.min.js","sourcesContent":["/* global jQuery */\r\n\r\nvoid function _initSearchBar($){\r\n\t'use strict';\r\n\t\r\n\tfunction search(e, _term) {\r\n\t\te.stopPropagation();\r\n\r\n\t\tconst $input = e.data.input;\r\n\t\tconst $icon = e.data.icon;\r\n\t\tconst $resultsWrapper = e.data.resultsWrapper;\r\n\t\tconst $results = e.data.results;\r\n\t\tconst $backdrop = e.data.backdrop;\r\n\t\tconst $zIndex = e.data.zIndex;\r\n\t\tconst term = _term || $input.val();\r\n\r\n\t\tif($icon.hasClass('fa-search')) {\r\n\t\t\t$icon.toggleClass('fa-search fa-spin fa-spinner');\r\n\t\t}\r\n\r\n\t\tif(!term || !term.trim() || term.trim().length < 3) {\r\n\t\t\t\r\n\t\t\t$results.html('')\r\n\t\t\t\t\t.append('<p>Sorry, you must have at least 3 letters before searching</p>');\r\n\t\t\t$resultsWrapper.removeClass('hidden')\r\n\t\t\t$icon.toggleClass('fa-search fa-spin fa-spinner');\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$.ajax({\r\n\t\t\ttype: 'POST',\r\n\t\t\turl: '/search',\r\n\t\t\tcontentType: 'application/json',\r\n\t\t\tdata: JSON.stringify({term}),\r\n\t\t\tsuccess: (guides) => {\r\n\t\t\t\t$backdrop.removeClass('hidden');\r\n\t\t\t\t$zIndex.css('z-index', 1042);\r\n\t\t\t\t$results.html('');\r\n\t\t\t\t$resultsWrapper.removeClass('hidden');\r\n\r\n\t\t\t\tif(!guides || !guides.length) {\r\n\t\t\t\t\t$results.append('<p>No results</p>');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tguides.forEach((guide, i) => {\r\n\t\t\t\t\t\tconst $html = $(`\r\n\t\t\t\t\t\t\t${i === 0 ? `<span class='f-L pl-Sm mt-XXs'>${guides.length} results</span>` : ''}\r\n\t\t\t\t\t\t\t<a class='search-results--result' href='/${guide.author}/${guide.url}'>\r\n\t\t\t\t\t\t\t\t<div class='w-25 f-L'>\r\n\t\t\t\t\t\t\t\t\t<img class='w-100' src='https://s3-us-west-2.amazonaws.com/stellaroute/${guide.cardImage.replace('.jpg', '-thumb1.jpg').replace('.jpeg', '-thumb1.jpeg')}' />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div class='w-75 f-L plr-Sm pb-Sm ta-L fc-B'>\r\n\t\t\t\t\t\t\t\t\t<h2 class='mt-Sm'>${guide.names.display}</h2>\r\n\t\t\t\t\t\t\t\t\t<p class='fc-G__Dk lh-1 hidden-xs'>${guide.tagline || 'No Tagline Provided'}</p>\r\n\t\t\t\t\t\t\t\t\t<div class='js-countries fs-Sm'></div>\r\n\t\t\t\t\t\t\t\t\t<div class='js-tags fs-Sm hidden mt-Xs'></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t`);\r\n\r\n\t\t\t\t\t\tif(guide.countriesDisplay) {\r\n\t\t\t\t\t\t\tconst $countries = $html.find('.js-countries');\r\n\t\t\t\t\t\t\tguide.countriesDisplay.forEach((country) => {\r\n\t\t\t\t\t\t\t\t$countries.append(`<span class='fc-W bg-Gr p-XXs d-Ib'>${country}</span>`);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(guide.tags) {\r\n\t\t\t\t\t\t\tconst $tags = $html.find('.js-tags');\r\n\t\t\t\t\t\t\t$tags.removeClass('hidden');\r\n\t\t\t\t\t\t\tguide.tags.forEach((tag) => {\r\n\t\t\t\t\t\t\t\t$tags.append(`<span class='bw-Sm bs-S bc-G p-XXs d-Ib'>${tag}</span>`);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$results.append($html);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t$icon.toggleClass('fa-search fa-spin fa-spinner');\r\n\t\t\t},\r\n\t\t\terr: (err) => {\r\n\t\t\t\tthrow err;\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tfunction closeSearch(e) {\r\n\t\te.stopPropagation();\r\n\r\n\t\te.data.resultsWrapper.addClass('hidden');\r\n\t\te.data.backdrop.addClass('hidden');\r\n\t\te.data.zIndex.css('z-index', 'auto');\r\n\t\te.data.input.val('');\r\n\t}\r\n\r\n\r\n\tfunction startSearch(e) {\r\n\t\te.stopPropagation();\r\n\r\n\t\tconst $wrapper = e.data.wrapper;\r\n\t\tconst $icon = e.data.icon;\r\n\t\tconst $input = e.data.input;\r\n\r\n\t\tif($icon.hasClass('fa-search') && $input.val()) {\r\n\t\t\t$icon.toggleClass('fa-search fa-spin fa-spinner');\r\n\t\t}\r\n\r\n\t\tclearTimeout(e.data.timeout);\r\n\r\n\t\te.data.timeout = setTimeout(() => {\r\n\t\t\t$wrapper.trigger('duck.search', [$input.val()]);\r\n\t\t}, 1000)\r\n\t}\r\n\r\n\tfunction goToSearchPage(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\twindow.location.href = `/search?term=${e.data.input.val()}`\r\n\t}\r\n\r\n\tfunction initSearchBar(wrapper) {\r\n\t\tconst $wrapper = $(wrapper);\r\n\t\tconst $icon = $wrapper.find('.js-search-icon');\r\n\t\tconst $input = $wrapper.find('.js-search-input');\r\n\t\tconst $button = $wrapper.find('.js-search-button');\r\n\t\tconst $resultsWrapper = $wrapper.find('.js-search-results-wrapper');\r\n\t\tconst $results = $wrapper.find('.js-search-results');\r\n\t\tconst $close = $wrapper.find('.js-close-search');\r\n\t\tconst $backdrop = $wrapper.find('.js-seach-backdrop');\r\n\t\tconst $zIndex = $('.js-search-bar-z-index');\r\n\t\tlet timeout;\r\n\t\t\r\n\t\t$input.off('input', startSearch).on('input', {wrapper: $wrapper, icon: $icon, input: $input, timeout}, startSearch);\r\n\t\t$wrapper.off('duck.search', search).on('duck.search', {input: $input, icon: $icon, resultsWrapper: $resultsWrapper, results: $results, backdrop: $backdrop, zIndex: $zIndex}, search);\r\n\t\t$close.off('click', closeSearch).on('click', {resultsWrapper: $resultsWrapper, backdrop: $backdrop, input: $input, zIndex: $zIndex}, closeSearch);\r\n\t\t$button.off('click', goToSearchPage).on('click', {input: $input}, goToSearchPage)\r\n\t}\r\n\r\n\t$.fn.searchBar = function init() {\r\n\t\treturn this.each((index, wrapper) => initSearchBar(wrapper));\r\n\t}\r\n\r\n\t$(() => {$('.js-search-bar').searchBar()});\r\n}(jQuery.noConflict())"]}