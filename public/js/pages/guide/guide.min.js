"use strict";void function(e){function a(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,d=a.find('[data-sort="item"]'),t=e.data.expandeCollapseIcon,n=t.hasClass("fa-compress"),i=e.data.previewCardsIcon;a.find('[role="tab"][aria-expanded="'+!!n+'"]').click(),d.addClass("guide-card--edit-mode"),t.toggleClass("fa-compress fa-expand"),i.removeClass("fa-pencil").addClass("fa-eye")}function d(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,d=e.data.expandeCollapseIcon,t=a.find(".js-card"),n=e.data.previewCardsIcon;a.find('[role="tab"][aria-expanded="false"]').click(),d.removeClass("fa-expand").addClass("fa-compress"),n.hasClass("fa-eye")?t.trigger("exitEditMode"):t.trigger("enterEditMode"),n.toggleClass("fa-eye fa-pencil")}function t(e){e.data.cardsWrapper.find('[duck-button="add"]').addClass("hidden"),e.data.addCardIcon.removeClass("fa-eye").addClass("fa-pencil")}function n(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,d=e.data.addCardIcon,n=a.find('[duck-button="add"]');n.removeClass("hidden"),d.hasClass("fa-eye")?t({data:{cardsWrapper:a,addCardIcon:d}}):d.removeClass("fa-pencil").addClass("fa-eye")}function i(a){var d=e(a),t=d.find('.panel-heading[role="tab"]'),n=d.find('[duck-field="style"] select'),i=d.find(".card-styles--preview"),o=d.find('[duck-type="string"] [duck-value]'),s=d.find(".js-card-title"),r=d.find('[duck-type="image"]'),c=r.find("[duck-value]"),l=d.find(".js-card-image"),u=d.find('[duck-type="wysiwyg"]'),p=u.find(".summernote"),f=d.find(".js-card-text"),g=d.find(".js-card-toggle"),m=["section","sub","plain","white","danger","success","info"],v=["img","sub"];g.on("click",function(e){e.stopPropagation(),e.preventDefault(),d.parent().hasClass("guide-card--edit-mode")?d.trigger("exitEditMode"):d.trigger("enterEditMode")}),d.on("exitEditMode",function(){d.parent().removeClass("guide-card--edit-mode"),"false"===t.attr("aria-expanded")&&t.click()}),d.on("enterEditMode",function(){d.parent().addClass("guide-card--edit-mode")}),o.on("input",function(e){e.stopPropagation(),e.preventDefault();var a=o.val();a?s.removeClass("guide-card--placeholder").text(a):s.addClass("guide-card--placeholder").text("Card Title")}),p.on("summernote.change",function(e,a){a?f.removeClass("guide-card--placeholder").html(a):f.addClass("guide-card--placeholder").html("This is where the <strong>Text</strong> for the card will go.")}),n.on("input",function(e){e.stopPropagation(),e.preventDefault();var a=n.val();i.removeClass("card-styles--preview__active"),r.removeClass("hidden"),u.removeClass("hidden"),d.find('.card-styles--preview[card-style="'+a+'"]').addClass("card-styles--preview__active"),m.indexOf(a)>-1&&r.addClass("hidden"),v.indexOf(a)>-1&&u.addClass("hidden")}),c.on("change",function(a){a.stopPropagation(),a.preventDefault();var d=c.val()?"https://s3-us-west-2.amazonaws.com/stellaroute/"+c.val().replace(".","-medium."):"images/no-image--small.svg";l.each(function(a,t){var n=e(t);n.removeClass("guide-card--img__no-img"),n.attr("style")?n.attr("style","background-image: url('"+d+"')"):n.attr("src",d)})}),d.on("click",".js-delete-card",function(a){a.stopPropagation(),a.preventDefault();var d=e(a.delegateTarget).parent().find(".js-delete-card-form");d.addClass("z-1").delay(10).addClass("o-1")}),d.parent().on("click",".js-cancel-delete",function(a){a.stopPropagation(),a.preventDefault();var d=e(a.delegateTarget).find(".js-delete-card-form");d.removeClass("o-1").delay(180).removeClass("z-1")})}function o(e){var a=e.length,d=e.map(function(d,t,n){var i={};if(i.section=d,i.subCards=[],"section"!==i.section.style)return i;var o=t,s=e.length;return i.subCards=n.filter(function(e,d){return!(d<t||d>=a)&&("section"!==e.style||(t!==d&&(a=d,s=d),!1))}),e.splice(o,s-o-1),a=e.length,i}).filter(function(e){return e});return d}function s(a,d){a.stopPropagation(),a.preventDefault();var t=a.data.body,n=d.cards,i={isMe:!0,cards:o(n),guide:{isPublished:e(".js-is-publshed-text").hasClass("hidden")}};e.ajax({url:"/renderPug",data:{file:"../views/guides/body.pug",locals:i},success:function(a){var d=e(a);t.html(d),t.trigger("guide.init.body")}})}function r(t){t.stopPropagation();var i=t.data.body,o=i,r=e(".js-guide-cards"),l=e(".js-expand-collapse"),u=l.find(".fa"),p=e(".js-preview-cards"),f=p.find(".fa"),g=e(".js-add-card-start"),m=g.find(".fa");i.find('[data-function*="interiorNav"]').interiorNav(),i.find('[data-function*="accordion"]').makeAccordion(),i.find("[duck-table]").add(i).duckForm(),i.find('[data-function*="sort"]').sortable(),i.find('[data-function*="toggle"]').makeToggle(),i.find('[data-function*="form"], [duck-table], form').validateForm(),e(".js-card").guideCard(),e.ajax({url:"/renderPug",data:{file:"../views/guides/cards/_card.pug",locals:{isMe:!0,card:{style:"big"},startInEditMode:!0}},success:function(a){r.prop("ArrayItemTemplate",e(a))}}),o.on("guide.update.body",{body:i},s),o.on("duck.form.submitted",function(e,a){e.stopPropagation(),o.trigger("guide.update.body",[a]),o.find('[duck-button="submit"] .fa').toggleClass("fa-spinner fa-spin fa-floppy-o"),o.find('[duck-button="submit"]').prop("disabled",!0)}),o.on("duck.form.success",function(e){e.stopPropagation(),o.find('[duck-button="submit"] .fa').toggleClass("fa-spinner fa-spin fa-floppy-o"),o.find('[duck-button="submit"]').prop("disabled",!1),r.find(".js-card").trigger("exitEditMode"),f.removeClass("fa-eye").addClass("fa-pencil")}),o.on("duck.form.error",function(e){e.stopPropagation();var a=c.clone();r.prepend(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),o.find('[duck-button="submit"] .fa').toggleClass("fa-spinner fa-spin fa-floppy-o"),o.find('[duck-button="submit"]').prop("disabled",!1)}),g.on("click",{cardsWrapper:r,addCardIcon:m},n),l.on("click",{cardsWrapper:r,expandeCollapseIcon:u,previewCardsIcon:f},a),p.on("click",{cardsWrapper:r,expandeCollapseIcon:u,previewCardsIcon:f},d)}var c=e('<div class="alert alert-danger p-A z-1 l-0 r-0 t-0">Something went wrong, please try again.</div>');e.fn.guideCard=function(){return this.each(function(e,a){i(a)})},e(function(){var a=e(".js-guide-body");a.on("guide.init.body",{body:a},r),a.trigger("guide.init.body");var d=e(".sub-header"),t=d.find(".js-publish-form"),n=t.find(".js-publish"),i=t.find(".js-publish-icon"),o=d.find(".js-is-publshed-text"),s=e("#GuideDetailsForm"),l=s.find('[duck-button="submit"] .fa'),u=s.find('[duck-button="edit"]'),p=u.find(".fa"),f=s.find('[duck-field="bannerImage"] [duck-value]');n.on("change",function(e){e.stopPropagation(),t.trigger("duck.form.submit")}),t.on("duck.form.submitted",function(e){e.stopPropagation(),e.preventDefault(),n.prop("disabled",!0),i.removeClass("hidden")}),t.on("duck.form.success",function(e){e.stopPropagation(),e.preventDefault(),o.toggleClass("hidden"),n.prop("disabled",!1),i.addClass("hidden")}),t.on("duck.form.error",function(e){e.stopPropagation(),e.preventDefault();var a=c.clone();t.append(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),n.prop("disabled",!1),i.addClass("hidden")}),u.on("click",function(e){e.stopPropagation(),e.preventDefault(),p.toggleClass("fa-eye fa-pencil")}),s.on("duck.form.submitted",function(e){e.stopPropagation(),l.toggleClass("hidden")}),s.on("duck.form.success",function(e){e.stopPropagation();var a="https://s3-us-west-2.amazonaws.com/stellaroute/"+f.val().replace(".jpg","-large.jpg");s.modal("hide"),d.css("background-image",'url("'+a+'")'),l.toggleClass("hidden"),s.find('[duck-button="submit"]').prop("disabled",!1),u.click()}),s.on("duck.form.error",function(e){e.stopPropagation();var a=c.clone();s.prepend(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),l.toggleClass("hidden"),s.find('[duck-button="submit"]').prop("disabled",!1)})})}(jQuery.noConflict());
//# sourceMappingURL=guide.min.js.map
