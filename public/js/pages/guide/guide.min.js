"use strict";void function(e){function a(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,t=a.find('[data-sort="item"]'),d=e.data.expandeCollapseIcon,n=d.hasClass("fa-compress"),o=e.data.previewCardsIcon;a.find('[role="tab"][aria-expanded="'+!!n+'"]').click(),t.addClass("guide-card--edit-mode"),d.toggleClass("fa-compress fa-expand"),o.removeClass("fa-pencil").addClass("fa-eye")}function t(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,t=e.data.expandeCollapseIcon,d=a.find(".js-card"),n=e.data.previewCardsIcon;a.find('[role="tab"][aria-expanded="false"]').click(),t.removeClass("fa-expand").addClass("fa-compress"),n.hasClass("fa-eye")?d.trigger("exitEditMode"):d.trigger("enterEditMode"),n.toggleClass("fa-eye fa-pencil")}function d(e){e.data.cardsWrapper.find('[duck-button="add"]').addClass("hidden"),e.data.addCardIcon.removeClass("fa-eye").addClass("fa-pencil")}function n(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,t=e.data.addCardIcon,n=a.find('[duck-button="add"]');n.removeClass("hidden"),t.hasClass("fa-eye")?d({data:{cardsWrapper:a,addCardIcon:t}}):t.removeClass("fa-pencil").addClass("fa-eye")}function o(a){var t=e(a),d=t.closest("[duck-table]"),n=t.find('.panel-heading[role="tab"]'),o=t.find('[duck-field="style"] select'),i=t.find(".card-styles--preview"),r=t.find('[duck-type="string"] [duck-value]'),s=t.find(".js-card-title"),c=t.find('[duck-type="image"]'),l=c.find("[duck-value]"),u=t.find(".js-card-image"),p=t.find('[duck-type="wysiwyg"]'),f=p.find(".summernote"),g=t.find(".js-card-text"),m=t.find(".js-card-toggle"),v=["section","sub","plain","white","danger","success","info"],C=["img","sub"];m.on("click",function(e){e.stopPropagation(),e.preventDefault(),t.parent().hasClass("guide-card--edit-mode")?t.trigger("exitEditMode"):t.trigger("enterEditMode")}),t.on("exitEditMode",function(){t.parent().removeClass("guide-card--edit-mode"),"false"===n.attr("aria-expanded")&&n.click()}),t.on("enterEditMode",function(){t.parent().addClass("guide-card--edit-mode")}),r.on("input",function(e){e.stopPropagation(),e.preventDefault();var a=r.val();a?s.removeClass("guide-card--placeholder").text(a):s.addClass("guide-card--placeholder").text("Card Title")}),f.on("summernote.change",function(e,a){a?g.removeClass("guide-card--placeholder").html(a):g.addClass("guide-card--placeholder").html("This is where the <strong>Text</strong> for the card will go.")}),o.on("input",function(e){e.stopPropagation(),e.preventDefault();var a=o.val();i.removeClass("card-styles--preview__active"),c.removeClass("hidden"),p.removeClass("hidden"),t.find('.card-styles--preview[card-style="'+a+'"]').addClass("card-styles--preview__active"),v.indexOf(a)>-1&&c.addClass("hidden"),C.indexOf(a)>-1&&p.addClass("hidden")}),l.on("change",function(a){a.stopPropagation(),a.preventDefault();var t=l.val()?"https://s3-us-west-2.amazonaws.com/stellaroute/"+l.val().replace(".","-medium."):"images/no-image--small.svg";u.each(function(a,d){var n=e(d);n.removeClass("guide-card--img__no-img"),n.attr("style")?n.attr("style","background-image: url('"+t+"')"):n.attr("src",t)})}),t.on("click",".js-delete-card",function(a){a.stopPropagation(),a.preventDefault();var t=e(a.delegateTarget).parent().find(".js-delete-card-form");t.addClass("z-1").delay(10).addClass("o-1")}),t.parent().find('[duck-button="delete"]').on("click",function(e){e.stopPropagation(),e.preventDefault(),d.trigger("duck.form.submit")}),t.parent().on("click",".js-cancel-delete",function(a){a.stopPropagation(),a.preventDefault();var t=e(a.delegateTarget).find(".js-delete-card-form");t.removeClass("o-1").delay(180).removeClass("z-1")})}function i(e){var a=e.length,t=e.map(function(t,d,n){var o={};if(o.section=t,o.subCards=[],"section"!==o.section.style)return o;var i=d,r=e.length;return o.subCards=n.filter(function(e,t){return!(t<d||t>=a)&&("section"!==e.style||(d!==t&&(a=t,r=t),!1))}),e.splice(i,r-i-1),a=e.length,o}).filter(function(e){return e});return t}function r(a,t){a.stopPropagation(),a.preventDefault();var d=a.data.body,n=t.cards,o={isMe:!0,cards:i(n),guide:{Id:t.Id,isPublished:e(".js-is-publshed-text").hasClass("hidden")}};e.ajax({url:"/renderPug",data:{file:"../views/guides/body.pug",locals:o},success:function(a){var t=e(a);d.html(t).trigger("guide.init.body")}})}function s(d,o){d.stopPropagation();var i=d.data.body,s=i.find('[duck-table="Guides"]'),l=e(".js-guide-cards"),u=e(".js-expand-collapse"),p=u.find(".fa"),f=e(".js-preview-cards"),g=f.find(".fa"),m=e(".js-add-card-start"),v=m.find(".fa"),C=l.find(".fa.fa-spinner");o||!function(){i.find('[data-function*="interiorNav"]').interiorNav(),i.find('[data-function*="accordion"]').makeAccordion(),i.find("[duck-table]").duckForm(),i.find('[data-function*="sort"]').sortable(),i.find('[data-function*="toggle"]').makeToggle(),i.find('[data-function*="form"], [duck-table], form').validateForm(),e('[data-toggle="tooltip"]').tooltip();var a=e(".summernote"),t=a.length,d=0,n=window.summernoteOptions,o=setInterval(function(){a.eq(d).summernote(n),d++,d>=t&&clearInterval(o)},250)}(),e(".js-card").guideCard(),e.ajax({url:"/renderPug",data:{file:"../views/guides/cards/_card.pug",locals:{isMe:!0,card:{style:"big"},startInEditMode:!0}},success:function(a){l.prop("ArrayItemTemplate",e(a))}}),s.on("guide.update.body",{body:i},r),s.on("duck.form.submitted",function(e){e.stopPropagation(),s.find('[duck-button="submit"]').prop("disabled",!0),s.addClass("guide-submiting"),C.removeClass("hidden")}),s.on("duck.form.success",function(e,a){e.stopPropagation(),s.trigger("guide.update.body",[a])}),s.on("duck.form.error",function(e){e.stopPropagation();var a=c.clone();s.find('[duck-button="submit"]').prop("disabled",!1),l.prepend(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),C.addClass("hidden"),s.removeClass("guide-submiting")}),m.on("click",{cardsWrapper:l,addCardIcon:v},n),u.on("click",{cardsWrapper:l,expandeCollapseIcon:p,previewCardsIcon:g},a),f.on("click",{cardsWrapper:l,expandeCollapseIcon:p,previewCardsIcon:g},t)}var c=e('<div class="alert alert-danger p-A z-1 l-0 r-0 t-0">Something went wrong, please try again.</div>');e.fn.guideCard=function(){return this.each(function(e,a){o(a)})},e(function(){var a=e(".js-guide-body");a.on("guide.init.body",{body:a},s),a.trigger("guide.init.body",[!0]);var t=e(".sub-header"),d=t.find(".js-publish-form"),n=d.find(".js-publish"),o=d.find(".js-publish-icon"),i=t.find(".js-is-publshed-text"),r=e("#GuideDetailsForm"),l=r.find('[duck-button="submit"] .fa'),u=r.find('[duck-button="edit"]'),p=u.find(".fa"),f=r.find('[duck-field="bannerImage"] [duck-value]');n.on("change",function(e){e.stopPropagation(),d.trigger("duck.form.submit")}),d.on("duck.form.submitted",function(e){e.stopPropagation(),e.preventDefault(),n.prop("disabled",!0),o.removeClass("hidden")}),d.on("duck.form.success",function(e){e.stopPropagation(),e.preventDefault(),i.toggleClass("hidden"),n.prop("disabled",!1),o.addClass("hidden")}),d.on("duck.form.error",function(e){e.stopPropagation(),e.preventDefault();var a=c.clone();d.append(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),n.prop("disabled",!1),o.addClass("hidden")}),u.on("click",function(e){e.stopPropagation(),e.preventDefault(),p.toggleClass("fa-eye fa-pencil")}),r.on("duck.form.submitted",function(e){e.stopPropagation(),l.toggleClass("hidden")}),r.on("duck.form.success",function(e){e.stopPropagation();var a="https://s3-us-west-2.amazonaws.com/stellaroute/"+f.val().replace(".jpg","-large.jpg");r.modal("hide"),t.css("background-image",'url("'+a+'")'),l.toggleClass("hidden"),r.find('[duck-button="submit"]').prop("disabled",!1),u.click()}),r.on("duck.form.error",function(e){e.stopPropagation();var a=c.clone();r.prepend(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),l.toggleClass("hidden"),r.find('[duck-button="submit"]').prop("disabled",!1)})})}(jQuery.noConflict());
//# sourceMappingURL=guide.min.js.map
