"use strict";void function(e){function a(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,d=a.find('[data-sort="item"]'),t=e.data.expandeCollapseIcon,n=t.hasClass("fa-compress"),o=e.data.previewCardsIcon;a.find('[role="tab"][aria-expanded="'+!!n+'"]').click(),d.addClass("guide-card--edit-mode"),t.toggleClass("fa-compress fa-expand"),o.removeClass("fa-pencil").addClass("fa-eye")}function d(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,d=e.data.expandeCollapseIcon,t=a.find(".js-card"),n=e.data.previewCardsIcon;a.find('[role="tab"][aria-expanded="false"]').click(),d.removeClass("fa-expand").addClass("fa-compress"),n.hasClass("fa-eye")?t.trigger("exitEditMode"):t.trigger("enterEditMode"),n.toggleClass("fa-eye fa-pencil")}function t(e){e.data.cardsWrapper.find('[duck-button="add"]').addClass("hidden"),e.data.addCardIcon.removeClass("fa-eye").addClass("fa-pencil")}function n(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,d=e.data.addCardIcon,n=a.find('[duck-button="add"]');n.removeClass("hidden"),d.hasClass("fa-eye")?t({data:{cardsWrapper:a,addCardIcon:d}}):d.removeClass("fa-pencil").addClass("fa-eye")}function o(a){var d=e(a),t=d.closest("[duck-table]"),n=d.find('.panel-heading[role="tab"]'),o=d.find('[duck-field="style"] select'),i=d.find(".card-styles--preview"),r=d.find('[duck-type="string"] [duck-value]'),s=d.find(".js-card-title"),l=d.find('[duck-type="image"]'),c=l.find("[duck-value]"),u=d.find(".js-card-image"),p=d.find('[duck-type="wysiwyg"]'),f=p.find(".summernote"),g=d.find(".js-card-text"),m=d.find(".js-card-toggle"),v=["section","sub","plain","white","danger","success","info"],b=["img","sub"];m.on("click",function(e){e.stopPropagation(),e.preventDefault(),d.parent().hasClass("guide-card--edit-mode")?d.trigger("exitEditMode"):d.trigger("enterEditMode")}),d.on("exitEditMode",function(){d.parent().removeClass("guide-card--edit-mode"),"false"===n.attr("aria-expanded")&&n.click()}),d.on("enterEditMode",function(){d.parent().addClass("guide-card--edit-mode")}),r.on("input",function(e){e.stopPropagation(),e.preventDefault();var a=r.val();a?s.removeClass("guide-card--placeholder").text(a):s.addClass("guide-card--placeholder").text("Card Title")}),f.on("summernote.change",function(e,a){a?g.removeClass("guide-card--placeholder").html(a):g.addClass("guide-card--placeholder").html("This is where the <strong>Text</strong> for the card will go.")}),o.on("input",function(e){e.stopPropagation(),e.preventDefault();var a=o.val();i.removeClass("card-styles--preview__active"),l.removeClass("hidden"),p.removeClass("hidden"),d.find('.card-styles--preview[card-style="'+a+'"]').addClass("card-styles--preview__active"),v.indexOf(a)>-1&&l.addClass("hidden"),b.indexOf(a)>-1&&p.addClass("hidden")}),c.on("change",function(a){a.stopPropagation(),a.preventDefault();var d=c.val()?"https://s3-us-west-2.amazonaws.com/stellaroute/"+c.val().replace(".","-medium."):"images/no-image--small.svg";u.each(function(a,t){var n=e(t);n.removeClass("guide-card--img__no-img"),n.attr("style")?n.attr("style","background-image: url('"+d+"')"):n.attr("src",d)})}),d.on("click",".js-delete-card",function(a){a.stopPropagation(),a.preventDefault();var d=e(a.delegateTarget).parent().find(".js-delete-card-form");d.addClass("z-1").delay(10).addClass("o-1")}),d.parent().find('[duck-button="delete"]').on("click",function(e){e.stopPropagation(),e.preventDefault(),t.trigger("duck.form.submit")}),d.parent().on("click",".js-cancel-delete",function(a){a.stopPropagation(),a.preventDefault();var d=e(a.delegateTarget).find(".js-delete-card-form");d.removeClass("o-1").delay(180).removeClass("z-1")})}function i(e){var a=e.length,d=e.map(function(d,t,n){var o={};if(o.section=d,o.subCards=[],"section"!==o.section.style)return o;var i=t,r=e.length;return o.subCards=n.filter(function(e,d){return!(d<t||d>=a)&&("section"!==e.style||(t!==d&&(a=d,r=d),!1))}),e.splice(i,r-i-1),a=e.length,o}).filter(function(e){return e});return d}function r(a,d){a.stopPropagation(),a.preventDefault();var t=a.data.body,n=d.cards,o={isMe:!0,cards:i(n),guide:{Id:d.Id,isPublished:e(".js-is-publshed-text").hasClass("hidden")}};e.ajax({url:"/renderPug",data:{file:"../views/guides/body.pug",locals:o},success:function(a){var d=e(a);t.html(d).trigger("guide.init.body")}})}function s(t,o){t.stopPropagation();var i=t.data.body,s=i.find('[duck-table="Guides"]'),c=e(".js-guide-cards"),u=e(".js-expand-collapse"),p=u.find(".fa"),f=e(".js-preview-cards"),g=f.find(".fa"),m=e(".js-add-card-start"),v=m.find(".fa"),b=c.find(".fa.fa-spinner");o||!function(){i.find('[data-function*="interiorNav"]').interiorNav(),i.find('[data-function*="accordion"]').makeAccordion(),i.find("[duck-table]").duckForm(),i.find('[data-function*="sort"]').sortable(),i.find('[data-function*="toggle"]').makeToggle(),i.find('[data-function*="form"], [duck-table], form').validateForm(),e('[data-toggle="tooltip"]').tooltip();var a=e(".summernote"),d=a.length,t=0,n={height:150,disableDragAndDrop:!0,toolbar:[["style",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["table","hr"]],["link",["link"]],["misc",["fullscreen","codeview"]],["misc",["undo","redo","help"]]]},o=setInterval(function(){a.eq(t).summernote(n),t++,t>=d&&clearInterval(o)},250)}(),e(".js-card").guideCard(),e.ajax({url:"/renderPug",data:{file:"../views/guides/cards/_card.pug",locals:{isMe:!0,card:{style:"big"},startInEditMode:!0}},success:function(a){c.prop("ArrayItemTemplate",e(a))}}),s.on("guide.update.body",{body:i},r),s.on("duck.form.submitted",function(e){e.stopPropagation(),s.find('[duck-button="submit"]').prop("disabled",!0),s.addClass("guide-submiting"),b.removeClass("hidden")}),s.on("duck.form.success",function(e,a){e.stopPropagation(),s.trigger("guide.update.body",[a])}),s.on("duck.form.error",function(e){e.stopPropagation();var a=l.clone();s.find('[duck-button="submit"]').prop("disabled",!1),c.prepend(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),b.addClass("hidden"),s.removeClass("guide-submiting")}),m.on("click",{cardsWrapper:c,addCardIcon:v},n),u.on("click",{cardsWrapper:c,expandeCollapseIcon:p,previewCardsIcon:g},a),f.on("click",{cardsWrapper:c,expandeCollapseIcon:p,previewCardsIcon:g},d)}var l=e('<div class="alert alert-danger p-A z-1 l-0 r-0 t-0">Something went wrong, please try again.</div>');e.fn.guideCard=function(){return this.each(function(e,a){o(a)})},e(function(){var a=e(".js-guide-body");a.on("guide.init.body",{body:a},s),a.trigger("guide.init.body",[!0]);var d=e(".sub-header"),t=d.find(".js-publish-form"),n=t.find(".js-publish"),o=t.find(".js-publish-icon"),i=d.find(".js-is-publshed-text"),r=e("#GuideDetailsForm"),c=r.find('[duck-button="submit"] .fa'),u=r.find('[duck-button="edit"]'),p=u.find(".fa"),f=r.find('[duck-field="bannerImage"] [duck-value]');n.on("change",function(e){e.stopPropagation(),t.trigger("duck.form.submit")}),t.on("duck.form.submitted",function(e){e.stopPropagation(),e.preventDefault(),n.prop("disabled",!0),o.removeClass("hidden")}),t.on("duck.form.success",function(e){e.stopPropagation(),e.preventDefault(),i.toggleClass("hidden"),n.prop("disabled",!1),o.addClass("hidden")}),t.on("duck.form.error",function(e){e.stopPropagation(),e.preventDefault();var a=l.clone();t.append(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),n.prop("disabled",!1),o.addClass("hidden")}),u.on("click",function(e){e.stopPropagation(),e.preventDefault(),p.toggleClass("fa-eye fa-pencil")}),r.on("duck.form.submitted",function(e){e.stopPropagation(),c.toggleClass("hidden")}),r.on("duck.form.success",function(e){e.stopPropagation();var a="https://s3-us-west-2.amazonaws.com/stellaroute/"+f.val().replace(".jpg","-large.jpg");r.modal("hide"),d.css("background-image",'url("'+a+'")'),c.toggleClass("hidden"),r.find('[duck-button="submit"]').prop("disabled",!1),u.click()}),r.on("duck.form.error",function(e){e.stopPropagation();var a=l.clone();r.prepend(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),c.toggleClass("hidden"),r.find('[duck-button="submit"]').prop("disabled",!1)})})}(jQuery.noConflict());
//# sourceMappingURL=guide.min.js.map
