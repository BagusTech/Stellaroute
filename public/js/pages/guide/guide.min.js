"use strict";void function(e,a){function t(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,t=a.find('[data-sort="item"]'),d=e.data.expandeCollapseIcon,n=d.hasClass("fa-compress"),i=e.data.previewCardsIcon;a.find('[role="tab"][aria-expanded="'+!!n+'"]').click(),t.addClass("guide-card--edit-mode"),d.toggleClass("fa-compress fa-expand"),i.removeClass("fa-pencil").addClass("fa-eye")}function d(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,t=e.data.expandeCollapseIcon,d=a.find(".js-card"),n=e.data.previewCardsIcon;a.find('[role="tab"][aria-expanded="false"]').click(),t.removeClass("fa-expand").addClass("fa-compress"),n.hasClass("fa-eye")?d.trigger("exitEditMode"):d.trigger("enterEditMode"),n.toggleClass("fa-eye fa-pencil")}function n(e){e.data.cardsWrapper.find('[duck-button="add"]').addClass("hidden"),e.data.addCardIcon.removeClass("fa-eye").addClass("fa-pencil")}function i(e){e.stopPropagation(),e.preventDefault();var a=e.data.cardsWrapper,t=e.data.addCardIcon,d=a.find('[duck-button="add"]');d.removeClass("hidden"),t.hasClass("fa-eye")?n({data:{cardsWrapper:a,addCardIcon:t}}):t.removeClass("fa-pencil").addClass("fa-eye")}function o(a){var t=e(a),d=t.closest("[duck-table]"),n=t.find('.panel-heading[role="tab"]'),i=t.find('[duck-field="style"] select'),o=t.find(".card-styles--preview"),s=t.find('[duck-type="string"] [duck-value]'),r=t.find(".js-card-title"),c=t.find('[duck-type="image"]'),l=c.find("[duck-value]"),u=t.find(".js-card-image"),p=t.find('[duck-type="wysiwyg"]'),f=p.find(".summernote"),g=t.find(".js-card-text"),m=t.find(".js-card-toggle"),v=["section","sub","plain","white","danger","success","info"],b=["img","sub"];m.on("click",function(e){e.stopPropagation(),e.preventDefault(),t.parent().hasClass("guide-card--edit-mode")?t.trigger("exitEditMode"):t.trigger("enterEditMode")}),t.on("exitEditMode",function(){t.parent().removeClass("guide-card--edit-mode"),"false"===n.attr("aria-expanded")&&n.click()}),t.on("enterEditMode",function(){t.parent().addClass("guide-card--edit-mode")}),s.on("input",function(e){e.stopPropagation(),e.preventDefault();var a=s.val();a?r.removeClass("guide-card--placeholder").text(a):r.addClass("guide-card--placeholder").text("Card Title")}),f.on("summernote.change",function(e,a){a?g.removeClass("guide-card--placeholder").html(a):g.addClass("guide-card--placeholder").html("This is where the <strong>Text</strong> for the card will go.")}),i.on("input",function(e){e.stopPropagation(),e.preventDefault();var a=i.val();o.removeClass("card-styles--preview__active"),c.removeClass("hidden"),p.removeClass("hidden"),t.find('.card-styles--preview[card-style="'+a+'"]').addClass("card-styles--preview__active"),v.indexOf(a)>-1&&c.addClass("hidden"),b.indexOf(a)>-1&&p.addClass("hidden")}),l.on("change",function(a){a.stopPropagation(),a.preventDefault();var t=l.val()?"https://s3-us-west-2.amazonaws.com/stellaroute/"+l.val().replace(".","-medium."):"images/no-image--small.svg";u.each(function(a,d){var n=e(d);n.removeClass("guide-card--img__no-img"),n.attr("style")?n.attr("style","background-image: url('"+t+"')"):n.attr("src",t)})}),t.on("click",".js-delete-card",function(a){a.stopPropagation(),a.preventDefault();var t=e(a.delegateTarget).parent().find(".js-delete-card-form");t.addClass("z-1").delay(10).addClass("o-1")}),t.parent().find('[duck-button="delete"]').on("click",function(e){e.stopPropagation(),e.preventDefault(),d.trigger("duck.form.submit")}),t.parent().on("click",".js-cancel-delete",function(a){a.stopPropagation(),a.preventDefault();var t=e(a.delegateTarget).find(".js-delete-card-form");t.removeClass("o-1").delay(180).removeClass("z-1")})}function s(e){var a=e.length,t=e.map(function(t,d,n){var i={};if(i.section=t,i.subCards=[],"section"!==i.section.style)return i;var o=d,s=e.length;return i.subCards=n.filter(function(e,t){return!(t<d||t>=a)&&("section"!==e.style||(d!==t&&(a=t,s=t),!1))}),e.splice(o,s-o-1),a=e.length,i}).filter(function(e){return e});return t}function r(a,t){a.stopPropagation(),a.preventDefault();var d=a.data.body,n=t.cards,i={isMe:!0,cards:s(n),guide:{Id:t.Id,isPublished:e(".js-is-publshed-text").hasClass("hidden")}};e.ajax({type:"POST",url:"/renderPug",contentType:"application/json",data:JSON.stringify({file:"../views/guides/body.pug",locals:i}),success:function(a){var t=e(a);d.html(t).trigger("guide.init.body")}})}function c(n,o){n.stopPropagation();var s=n.data.body,c=s.find('[duck-table="Guides"]'),u=e(".js-guide-cards"),p=e(".js-expand-collapse"),f=p.find(".fa"),g=e(".js-preview-cards"),m=g.find(".fa"),v=e(".js-add-card-start"),b=v.find(".fa"),C=u.find(".fa.fa-spinner");o||!function(){s.find('[data-function*="interiorNav"]').interiorNav(),s.find('[data-function*="accordion"]').makeAccordion(),s.find("[duck-table]").duckForm(),s.find('[data-function*="sort"]').sortable(),s.find('[data-function*="toggle"]').makeToggle(),s.find('[data-function*="form"], [duck-table], form').validateForm(),a.initDuckFilepicker(),e('[data-toggle="tooltip"]').tooltip();var t=e(".summernote"),d=t.length,n=0,i=window.summernoteOptions,o=setInterval(function(){t.eq(n).summernote(i),n++,n>=d&&clearInterval(o)},250)}(),e(".js-card").guideCard(),e.ajax({type:"POST",url:"/renderPug",contentType:"application/json",data:JSON.stringify({file:"../views/guides/cards/_card.pug",locals:{isMe:!0,card:{style:"big"},startInEditMode:!0}}),success:function(a){u.prop("ArrayItemTemplate",e(a))}}),c.on("guide.update.body",{body:s},r),c.on("duck.form.submitted",function(e){e.stopPropagation(),c.find('[duck-button="submit"]').prop("disabled",!0),c.addClass("guide-submiting"),C.removeClass("hidden")}),c.on("duck.form.success",function(e,a){e.stopPropagation(),c.trigger("guide.update.body",[a])}),c.on("duck.form.error",function(e){e.stopPropagation();var a=l.clone();c.find('[duck-button="submit"]').prop("disabled",!1),u.prepend(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),C.addClass("hidden"),c.removeClass("guide-submiting")}),v.on("click",{cardsWrapper:u,addCardIcon:b},i),p.on("click",{cardsWrapper:u,expandeCollapseIcon:f,previewCardsIcon:m},t),g.on("click",{cardsWrapper:u,expandeCollapseIcon:f,previewCardsIcon:m},d)}var l=e('<div class="alert alert-danger p-A z-1 l-0 r-0 t-0">Something went wrong, please try again.</div>');e.fn.guideCard=function(){return this.each(function(e,a){o(a)})},e(function(){var a=e(".js-guide-body");a.on("guide.init.body",{body:a},c),a.trigger("guide.init.body",[!0]);var t=e(".sub-header"),d=t.find(".js-publish-form"),n=d.find(".js-publish"),i=d.find(".js-publish-icon"),o=t.find(".js-is-publshed-text"),s=e("#GuideDetailsForm"),r=s.find('[duck-button="submit"] .fa'),u=s.find('[duck-button="edit"]'),p=u.find(".fa"),f=s.find('[duck-field="tags"]'),g=s.find('[duck-field="bannerImage"] [duck-value]');n.on("change",function(e){e.stopPropagation(),d.trigger("duck.form.submit")}),d.on("duck.form.submitted",function(e){e.stopPropagation(),e.preventDefault(),n.prop("disabled",!0),i.removeClass("hidden")}),d.on("duck.form.success",function(e){e.stopPropagation(),e.preventDefault(),o.toggleClass("hidden"),n.prop("disabled",!1),i.addClass("hidden")}),d.on("duck.form.error",function(e){e.stopPropagation(),e.preventDefault();var a=l.clone();d.append(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),n.prop("disabled",!1),i.addClass("hidden")}),u.on("click",function(e){e.stopPropagation(),e.preventDefault(),p.toggleClass("fa-eye fa-pencil")}),s.on("duck.form.submitted",function(e){e.stopPropagation(),r.toggleClass("hidden")}),s.on("duck.form.success",function(e){e.stopPropagation();var a="https://s3-us-west-2.amazonaws.com/stellaroute/"+g.val().replace(".jpg","-large.jpg");s.modal("hide"),t.css("background-image",'url("'+a+'")'),r.toggleClass("hidden"),s.find('[duck-button="submit"]').prop("disabled",!1),u.click()}),s.on("duck.form.error",function(e){e.stopPropagation();var a=l.clone();s.prepend(a),setTimeout(function(){a.slideUp(270)},3e3),setTimeout(function(){a.remove()},3270),r.toggleClass("hidden"),s.find('[duck-button="submit"]').prop("disabled",!1)}),f.prop("ArrayItemTemplate",e('<div class="input-group mb-Sm" duck-type="string" data-sort="item"><div class="input-group-addon" data-sort="handle"><i class="fa fa-arrows-v" aria-hidden="true"></i></div><input class="form-control" duck-value="" type="text"><div class="input-group-btn"><button class="btn btn-danger" duck-button="delete"><i class="fa fa-times" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>'))})}(jQuery.noConflict(),duck);
//# sourceMappingURL=guide.min.js.map
