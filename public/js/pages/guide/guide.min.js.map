{"version":3,"sources":["js/pages/guide/guide.js"],"names":["$","duck","$error","e","stopPropagation","preventDefault","data","cardsWrapper","$card","$cardsWrapper","find","hasClass","$expandeCollapseIcon","previewCardsIcon","$previewCardsIcon","isExpanded","click","addClass","toggleClass","removeClass","previewCards","expandeCollapseIcon","trigger","$icon","hideAddButtons","addCardIcon","showAddButtons","$addCardIcon","$addButtons","initCard","wrapper","closest","$cardForm","$cardTab","$cardStyles","$cardPreviews","$cardTitle","$cardTitles","$cardImageForm","$cardImage","$cardImages","$cardTextFrom","$cardText","$cardTexts","$editToggle","noImageCards","on","parent","title","val","text","we","contents","html","style","noTextCards","imgSrc","replace","$_cardImage","_cardImage","attr","$deleteForm","delegateTarget","delay","endSubCards","length","cards","_cards","obj","map","_card","cardIndex","arr","subCards","section","endIndex","filter","subCardIndex","_subCard","splice","startIndex","_","updateBody","guide","$body","body","isMe","locals","formatCardsForNav","Id","startInAddCardMode","ajax","type","url","contentType","file","JSON","success","$newBody","initGuideBody","skipGlobalInits","$cardsForm","$expandeCollapse","$previewCards","$addCard","interiorNav","makeAccordion","duckForm","sortable","makeToggle","validateForm","tooltip","$summernote","summernoteLength","summernoteToInit","initSummernotes","setInterval","eq","summernote","summernoteOptions","guideCard","stringify","card","startInEditMode","evt","prop","$saveIcons","item","_$error","clone","prepend","setTimeout","expandeCollapseAll","fn","i","$subHeader","$featuredForm","$featuredFormSubmit","$featuredFormIcon","$featuredFormText","$publishForm","$publish","$publishIcon","$publishedText","$guideDetailsForm","$guideDetailsSubmit","$guideDetailsSaveIcon","$guideDetailsEdit","$guideDetailsEditIcon","$guideDetailsTags","$guideDeleteForm","$guideDeleteSubmit","append","slideUp","remove","window","location","reload","$input","$guideDeleteSaveIcon"],"mappings":"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","file":"guide.min.js","sourcesContent":["/* global jQuery, duck */\r\n\r\nvoid function initCardStyle($, duck){\r\n\t'use strict';\r\n\r\n\tconst $error = $('<div class=\"alert alert-danger p-A z-1 l-0 r-0 t-0\">Something went wrong, please try again.</div>');\r\n\r\n\tfunction expandeCollapseAll(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tconst $cardsWrapper = e.data.cardsWrapper;\r\n\t\tconst $card = $cardsWrapper.find('[data-sort=\"item\"]');\r\n\t\tconst $expandeCollapseIcon = e.data.expandeCollapseIcon;\r\n\t\tconst isExpanded = $expandeCollapseIcon.hasClass('fa-compress');\r\n\t\tconst $previewCardsIcon = e.data.previewCardsIcon;\r\n\r\n\t\t$cardsWrapper.find(`[role=\"tab\"][aria-expanded=\"${isExpanded ? true : false}\"]`).click();\r\n\t\t$card.addClass('guide-card--edit-mode');\r\n\t\t$expandeCollapseIcon.toggleClass('fa-compress fa-expand')\r\n\t\t$previewCardsIcon.removeClass('fa-pencil').addClass('fa-eye')\r\n\t}\r\n\r\n\tfunction previewCards(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tconst $cardsWrapper = e.data.cardsWrapper;\r\n\t\tconst $expandeCollapseIcon = e.data.expandeCollapseIcon;\r\n\t\tconst $card = $cardsWrapper.find('.js-card');\r\n\t\tconst $icon = e.data.previewCardsIcon;\r\n\r\n\t\t$cardsWrapper.find(`[role=\"tab\"][aria-expanded=\"false\"]`).click();\r\n\t\t$expandeCollapseIcon.removeClass('fa-expand').addClass('fa-compress');\r\n\r\n\t\tif($icon.hasClass('fa-eye')) {\r\n\t\t\t$card.trigger('exitEditMode');\r\n\t\t} else {\r\n\t\t\t$card.trigger('enterEditMode');\r\n\t\t}\r\n\t\t\r\n\t\t$icon.toggleClass('fa-eye fa-pencil')\r\n\t}\r\n\r\n\tfunction hideAddButtons(e) {\r\n\t\te.data.cardsWrapper.find('[duck-button=\"add\"]').addClass('hidden');\r\n\t\te.data.addCardIcon.removeClass('fa-eye').addClass('fa-pencil');\r\n\t}\r\n\r\n\tfunction showAddButtons(e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tconst $cardsWrapper = e.data.cardsWrapper;\r\n\t\tconst $addCardIcon = e.data.addCardIcon;\r\n\t\tconst $addButtons = $cardsWrapper.find('[duck-button=\"add\"]');\r\n\r\n\t\t\r\n\t\t$addButtons.removeClass('hidden');\r\n\r\n\t\tif(!$addCardIcon.hasClass('fa-eye')) {\r\n\t\t\t$addCardIcon.removeClass('fa-pencil').addClass('fa-eye');\r\n\t\t} else {\r\n\t\t\thideAddButtons({data: {cardsWrapper: $cardsWrapper, addCardIcon: $addCardIcon}})\r\n\t\t}\r\n\t}\r\n\r\n\tfunction initCard(wrapper) {\r\n\t\tconst $card = $(wrapper);\r\n\t\tconst $cardForm = $card.closest('[duck-table]');\r\n\t\tconst $cardTab = $card.find('.panel-heading[role=\"tab\"]');\r\n\t\tconst $cardStyles = $card.find('[duck-field=\"style\"] select');\r\n\t\tconst $cardPreviews = $card.find('.card-styles--preview');\r\n\t\tconst $cardTitle = $card.find('[duck-type=\"string\"] [duck-value]');\r\n\t\tconst $cardTitles = $card.find('.js-card-title');\r\n\t\tconst $cardImageForm = $card.find('[duck-type=\"image\"]');\r\n\t\tconst $cardImage = $cardImageForm.find('[duck-value]');\r\n\t\tconst $cardImages = $card.find('.js-card-image');\r\n\t\tconst $cardTextFrom = $card.find('[duck-type=\"wysiwyg\"]');\r\n\t\tconst $cardText = $cardTextFrom.find('.summernote');\r\n\t\tconst $cardTexts = $card.find('.js-card-text');\r\n\t\tconst $editToggle = $card.find('.js-card-toggle');\r\n\t\tconst noImageCards = ['section', 'sub', 'plain', 'white', 'danger', 'success', 'info'];\r\n\t\tconst noTextCards = ['img', 'sub'];\r\n\t\t\r\n\r\n\t\t$editToggle.on('click', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif($card.parent().hasClass('guide-card--edit-mode')) {\r\n\t\t\t\t$card.trigger('exitEditMode');\r\n\t\t\t} else {\r\n\t\t\t\t$card.trigger('enterEditMode');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$card.on('exitEditMode', () => {\r\n\t\t\t$card.parent().removeClass('guide-card--edit-mode');\r\n\t\t\t\r\n\t\t\tif($cardTab.attr('aria-expanded') === 'false') {\r\n\t\t\t\t$cardTab.click();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$card.on('enterEditMode', () => {\r\n\t\t\t$card.parent().addClass('guide-card--edit-mode');\r\n\t\t});\r\n\r\n\t\t$cardTitle.on('input', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tconst title = $cardTitle.val();\r\n\r\n\t\t\tif(title) {\r\n\t\t\t\t$cardTitles.removeClass('guide-card--placeholder').text(title);\r\n\t\t\t} else {\r\n\t\t\t\t$cardTitles.addClass('guide-card--placeholder').text('Card Title');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$cardText.on('summernote.change', (we, contents) => {\r\n\t\t\tif(contents) {\r\n\t\t\t\t$cardTexts.removeClass('guide-card--placeholder').html(contents);\r\n\t\t\t} else {\r\n\t\t\t\t$cardTexts.addClass('guide-card--placeholder').html('This is where the <strong>Text</strong> for the card will go.');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$cardStyles.on('input', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tconst style = $cardStyles.val();\r\n\r\n\t\t\t$cardPreviews.removeClass('card-styles--preview__active');\r\n\t\t\t$cardImageForm.removeClass('hidden');\r\n\t\t\t$cardTextFrom.removeClass('hidden');\r\n\r\n\t\t\t$card.find(`.card-styles--preview[card-style=\"${style}\"]`).addClass('card-styles--preview__active');\r\n\r\n\t\t\tif(noImageCards.indexOf(style) > -1) {\r\n\t\t\t\t$cardImageForm.addClass('hidden');\r\n\t\t\t}\r\n\r\n\t\t\tif(noTextCards.indexOf(style) > -1) {\r\n\t\t\t\t$cardTextFrom.addClass('hidden');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$cardImage.on('change', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tconst imgSrc = $cardImage.val() ? `https://s3-us-west-2.amazonaws.com/stellaroute/${$cardImage.val().replace('.', '-medium.')}` : 'images/no-image--small.svg';\r\n\r\n\r\n\t\t\t$cardImages.each((j, _cardImage) => {\r\n\t\t\t\tconst $_cardImage = $(_cardImage);\r\n\r\n\t\t\t\t$_cardImage.removeClass('guide-card--img__no-img');\r\n\r\n\t\t\t\tif($_cardImage.attr('style')) {\r\n\t\t\t\t\t$_cardImage.attr('style', `background-image: url('${imgSrc}')`);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$_cardImage.attr('src', imgSrc);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$card.on('click', '.js-delete-card', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tconst $deleteForm = $(e.delegateTarget).parent().find('.js-delete-card-form');\r\n\r\n\t\t\t$deleteForm.addClass('z-1').delay(10).addClass('o-1');\r\n\t\t});\r\n\r\n\t\t$card.parent().find('[duck-button=\"delete\"]').on('click', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$cardForm.trigger('duck.form.submit');\r\n\t\t})\r\n\r\n\t\t$card.parent().on('click', '.js-cancel-delete', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tconst $deleteForm = $(e.delegateTarget).find('.js-delete-card-form');\r\n\r\n\t\t\t$deleteForm.removeClass('o-1').delay(180).removeClass('z-1');\r\n\t\t});\r\n\t}\r\n\r\n\t$.fn.guideCard = function init() {\r\n\t\treturn this.each((i, wrapper) => {\r\n\t\t\tinitCard(wrapper)\r\n\t\t})\t\r\n\t}\r\n\r\n\tfunction formatCardsForNav(_cards) {\r\n\t\tlet endSubCards = _cards.length\r\n\t\tconst cards = _cards.map((_card, cardIndex, arr) => {\r\n\t\t\tconst obj = {};\r\n\r\n\t\t\tobj.section = _card\r\n\t\t\tobj.subCards = [];\r\n\r\n\t\t\tif(obj.section.style !== 'section') {\r\n\t\t\t\treturn obj;\r\n\t\t\t}\r\n\r\n\t\t\tconst startIndex = cardIndex;\r\n\t\t\tlet endIndex = _cards.length;\r\n\t\t\tobj.subCards = arr.filter((_subCard, subCardIndex) => {\r\n\t\t\t\tif(subCardIndex < cardIndex || subCardIndex >= endSubCards) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(_subCard.style === 'section') {\r\n\t\t\t\t\tif(cardIndex !== subCardIndex) {\r\n\t\t\t\t\t\tendSubCards = subCardIndex;\r\n\t\t\t\t\t\tendIndex = subCardIndex;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\r\n\t\t\t_cards.splice(startIndex, (endIndex - startIndex - 1));\r\n\r\n\t\t\tendSubCards = _cards.length;\r\n\t\t\treturn obj;\r\n\t\t}).filter((_) => _);\r\n\r\n\t\treturn cards;\r\n\t}\r\n\r\n\tfunction updateBody(e, guide) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tconst $body = e.data.body;\r\n\t\tconst cards = guide.cards;\r\n\t\tconst locals = {\r\n\t\t\tisMe: true,\r\n\t\t\tcards: formatCardsForNav(cards),\r\n\t\t\tguide: {\r\n\t\t\t\tId: guide.Id,\r\n\t\t\t\tisPublished: $('.js-is-publshed-text').hasClass('hidden'),\r\n\t\t\t},\r\n\t\t\tstartInAddCardMode: true,\r\n\t\t};\r\n\r\n\t\t$.ajax({\r\n\t\t\ttype: 'POST',\r\n\t\t\turl: '/renderPug',\r\n\t\t\tcontentType: 'application/json',\r\n\t\t\tdata: JSON.stringify({file: '../views/guides/body.pug', locals}),\r\n\t\t\tsuccess: (data) => {\r\n\t\t\t\tconst $newBody = $(data);\r\n\t\t\t\t\r\n\t\t\t\t$body.html($newBody).trigger('guide.init.body');\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tfunction initGuideBody(e, skipGlobalInits) {\r\n\t\te.stopPropagation();\r\n\r\n\t\tconst $body = e.data.body;\r\n\t\tconst $cardsForm = $body.find('[duck-table=\"Guides\"]');\r\n\t\tconst $cardsWrapper = $('.js-guide-cards');\r\n\t\tconst $expandeCollapse = $('.js-expand-collapse');\r\n\t\tconst $expandeCollapseIcon = $expandeCollapse.find('.fa');\r\n\t\tconst $previewCards = $('.js-preview-cards');\r\n\t\tconst $previewCardsIcon = $previewCards.find('.fa');\r\n\t\tconst $addCard = $('.js-add-card-start');\r\n\t\tconst $addCardIcon = $addCard.find('.fa');\r\n\t\tconst $saveIcons = $cardsWrapper.find('.fa.fa-spinner');\r\n\r\n\t\tif(!skipGlobalInits) {\r\n\t\t\t$body.find('[data-function*=\"interiorNav\"]').interiorNav();\r\n\t\t\t$body.find('[data-function*=\"accordion\"]').makeAccordion();\r\n\t\t\t$body.find('[duck-table]').duckForm();\r\n\t\t\t$body.find('[data-function*=\"sort\"]').sortable();\r\n\t\t\t$body.find('[data-function*=\"toggle\"]').makeToggle();\r\n\t\t\t$body.find('[data-function*=\"form\"], [duck-table], form').validateForm();\r\n\t\t\tduck.initDuckFilepicker();\r\n\r\n\t\t\t// opt in to bootstrap popovers\r\n\t\t\t$('[data-toggle=\"tooltip\"]').tooltip()\r\n\r\n\t\t\t// initialize summernote where it is being used\r\n\t\t\tconst $summernote = $('.summernote');\r\n\t\t\tconst summernoteLength = $summernote.length;\r\n\t\t\tlet summernoteToInit = 0;\r\n\t\t\tconst summernoteOptions = window.summernoteOptions;\r\n\r\n\t\t\t// initiating summernotes on interval because it causes a noticable lag\r\n\t\t\t// if you do ~3+ more at once.\r\n\t\t\tconst initSummernotes = setInterval(() => {\r\n\t\t\t\t$summernote.eq(summernoteToInit).summernote(summernoteOptions);\r\n\t\t\t\tsummernoteToInit++;\r\n\t\t\t\tif(summernoteToInit >= (summernoteLength)) {\r\n\t\t\t\t\tclearInterval(initSummernotes);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}, 250);\r\n\t\t}\r\n\r\n\t\t$('.js-card').guideCard();\r\n\r\n\t\t$.ajax({\r\n\t\t\ttype: 'POST',\r\n\t\t\turl: '/renderPug',\r\n\t\t\tcontentType: 'application/json',\r\n\t\t\tdata: JSON.stringify({file: '../views/guides/cards/_card.pug', locals: {isMe: true, card: {style: 'big'}, startInEditMode: true}}),\r\n\t\t\tsuccess: (data) => {\r\n\t\t\t\t$cardsWrapper.prop('ArrayItemTemplate', $(data));\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\t$cardsForm.on('guide.update.body', {body: $body}, updateBody)\r\n\r\n\t\t$cardsForm.on('duck.form.submitted', (evt) => {\r\n\t\t\tevt.stopPropagation();\r\n\r\n\t\t\t$cardsForm.find('[duck-button=\"submit\"]').prop('disabled', true);\r\n\r\n\t\t\t$cardsForm.addClass('guide-submiting');\r\n\t\t\t$saveIcons.removeClass('hidden');\r\n\t\t\t//$cardsForm.find('[duck-button=\"submit\"] .fa').toggleClass('fa-spinner fa-spin fa-floppy-o');\r\n\t\t\t\r\n\t\t});\r\n\r\n\t\t$cardsForm.on('duck.form.success', (evt, item) => {\r\n\t\t\tevt.stopPropagation();\r\n\t\t\t\r\n\t\t\t$cardsForm.trigger('guide.update.body', [item]);\r\n\t\t\t//$cardsForm.find('[duck-button=\"submit\"] .fa').toggleClass('fa-spinner fa-spin fa-floppy-o');\r\n\t\t});\r\n\r\n\t\t$cardsForm.on('duck.form.error', (evt) => {\r\n\t\t\tevt.stopPropagation();\r\n\t\t\t\r\n\t\t\tconst _$error = $error.clone();\r\n\t\t\t$cardsForm.find('[duck-button=\"submit\"]').prop('disabled', false);\r\n\r\n\t\t\t$cardsWrapper.prepend(_$error);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.slideUp(270);\r\n\t\t\t}, 3000);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.remove();\r\n\t\t\t}, 3270);\r\n\t\t\t\r\n\t\t\t$saveIcons.addClass('hidden');\r\n\t\t\t$cardsForm.removeClass('guide-submiting');\r\n\t\t\t//$cardsForm.find('[duck-button=\"submit\"] .fa').toggleClass('fa-spinner fa-spin fa-floppy-o');\r\n\t\t});\r\n\r\n\t\t$addCard.on('click', {cardsWrapper: $cardsWrapper, addCardIcon: $addCardIcon}, showAddButtons);\r\n\t\t$expandeCollapse.on('click', {cardsWrapper: $cardsWrapper, expandeCollapseIcon: $expandeCollapseIcon, previewCardsIcon: $previewCardsIcon}, expandeCollapseAll);\r\n\t\t$previewCards.on('click', {cardsWrapper: $cardsWrapper, expandeCollapseIcon: $expandeCollapseIcon, previewCardsIcon: $previewCardsIcon}, previewCards);\r\n\t}\r\n\r\n\t$(() => {\r\n\t\tconst $body = $('.js-guide-body');\r\n\t\t$body.on('guide.init.body', {body: $body}, initGuideBody);\r\n\t\t$body.trigger('guide.init.body', [true]);\r\n\r\n\t\tconst $subHeader = $('.sub-header');\r\n\t\tconst $featuredForm = $subHeader.find('#MakeGuideFeatured');\r\n\t\tconst $featuredFormSubmit = $featuredForm.find('button');\r\n\t\tconst $featuredFormIcon = $featuredFormSubmit.find('.fa');\r\n\t\tconst $featuredFormText = $featuredFormSubmit.find('span');\r\n\t\tconst $publishForm = $subHeader.find('.js-publish-form');\r\n\t\tconst $publish = $publishForm.find('.js-publish');\r\n\t\tconst $publishIcon = $publishForm.find('.js-publish-icon');\r\n\t\tconst $publishedText = $subHeader.find('.js-is-publshed-text');\r\n\t\tconst $guideDetailsForm = $('#GuideDetailsForm');\r\n\t\tconst $guideDetailsSubmit = $guideDetailsForm.find('[duck-button=\"submit\"]');\r\n\t\tconst $guideDetailsSaveIcon = $guideDetailsSubmit.find('.fa');\r\n\t\tconst $guideDetailsEdit = $guideDetailsForm.find('[duck-button=\"edit\"]');\r\n\t\tconst $guideDetailsEditIcon = $guideDetailsEdit.find('.fa');\r\n\t\tconst $guideDetailsTags = $guideDetailsForm.find('[duck-field=\"tags\"]');\r\n\t\tconst $guideDeleteForm = $('#GuideDeleteForm');\r\n\t\tconst $guideDeleteSubmit = $guideDeleteForm.find('[duck-button=\"submit\"]');\r\n\t\tconst $guideDeleteSaveIcon = $guideDeleteSubmit.find('.fa');\r\n\t\t//const $bannerImage = $guideDetailsForm.find('[duck-field=\"bannerImage\"] [duck-value]');\r\n\r\n\t\t$publish.on('change', (e) => {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\t$publishForm.trigger('duck.form.submit')\r\n\t\t});\r\n\t\t$publishForm.on('duck.form.submitted', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$publish.prop('disabled', true);\r\n\t\t\t$publishIcon.removeClass('hidden');\r\n\t\t});\r\n\r\n\t\t$publishForm.on('duck.form.success', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$publishedText.toggleClass('hidden');\r\n\t\t\t$publish.prop('disabled', false);\r\n\t\t\t$publishIcon.addClass('hidden');\r\n\t\t});\r\n\r\n\t\t$publishForm.on('duck.form.error', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tconst _$error = $error.clone();\r\n\r\n\t\t\t$publishForm.append(_$error);\r\n\r\n\t\t\tsetTimeout(() => {_$error.slideUp(270);}, 3000)\r\n\t\t\tsetTimeout(() => {_$error.remove();}, 3270)\r\n\r\n\t\t\t$publish.prop('disabled', false);\r\n\t\t\t$publishIcon.addClass('hidden');\r\n\t\t});\r\n\r\n\t\t$guideDetailsEdit.on('click', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\t$guideDetailsSubmit.prop('disabled', true);\r\n\t\t\t$guideDetailsEditIcon.toggleClass('fa-eye fa-pencil');\r\n\t\t});\r\n\r\n\t\t$guideDetailsForm.on('duck.form.submitted', (e) => {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\t$guideDetailsSubmit.prop('disabled', true);\r\n\t\t\t$guideDetailsSaveIcon.toggleClass('hidden');\r\n\t\t});\r\n\r\n\t\t$guideDetailsForm.on('duck.form.success', (e) => {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\twindow.location.reload(true);\r\n\t\t});\r\n\r\n\t\t$guideDetailsForm.on('duck.form.error', (e) => {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\tconst _$error = $error.clone();\r\n\r\n\t\t\t$guideDetailsForm.prepend(_$error);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.slideUp(270);\r\n\t\t\t}, 3000);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.remove();\r\n\t\t\t}, 3270);\r\n\r\n\t\t\t$guideDetailsSubmit.prop('disabled', false);\r\n\t\t\t$guideDetailsSaveIcon.toggleClass('hidden');\r\n\t\t\t$guideDetailsForm.find('[duck-button=\"submit\"]').prop('disabled', false);\r\n\t\t});\r\n\r\n\t\t$featuredForm.on('duck.form.submitted', (e) => {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\t$featuredFormSubmit.prop('disabled', true);\r\n\t\t\t$featuredFormIcon.toggleClass('hidden');\r\n\t\t});\r\n\r\n\t\t$featuredForm.on('duck.form.success', (e) => {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\tconst $input = $featuredForm.find('input');\r\n\r\n\t\t\t$featuredFormSubmit.prop('disabled', false).toggleClass('btn-primary')\r\n\t\t\t$input.prop('checked', !$input.prop('checked'));\r\n\t\t\t$featuredFormIcon.toggleClass('hidden');\r\n\t\t\t$featuredFormText.text($featuredFormText.text() === 'Un-Feature Guide' ? 'Make Featured Guide' : 'Un-Feature Guide')\r\n\t\t});\r\n\r\n\t\t$featuredForm.on('duck.form.error', () => {\r\n\t\t\twindow.location.reload(true);\r\n\t\t})\r\n\r\n\t\t$guideDeleteForm.on('duck.form.submitted', (e) => {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\t$guideDeleteSubmit.prop('disabled', true);\r\n\t\t\t$guideDeleteSaveIcon.toggleClass('hidden');\r\n\t\t});\r\n\r\n\t\t$guideDeleteForm.on('duck.form.error', (e) => {\r\n\t\t\te.stopPropagation();\r\n\r\n\t\t\tconst _$error = $error.clone();\r\n\r\n\t\t\t$guideDeleteForm.prepend(_$error);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.slideUp(270);\r\n\t\t\t}, 3000);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.remove();\r\n\t\t\t}, 3270);\r\n\r\n\t\t\t$guideDeleteSubmit.prop('disabled', false);\r\n\t\t\t$guideDeleteSaveIcon.toggleClass('hidden');\r\n\t\t\t$guideDetailsForm.find('[duck-button=\"submit\"]').prop('disabled', false);\r\n\t\t});\r\n\r\n\t\t$guideDetailsTags.prop('ArrayItemTemplate', $('<div class=\"input-group mb-Sm\" duck-type=\"string\" data-sort=\"item\"><div class=\"input-group-addon\" data-sort=\"handle\"><i class=\"fa fa-arrows-v\" aria-hidden=\"true\"></i></div><input class=\"form-control\" duck-value=\"\" type=\"text\"><div class=\"input-group-btn\"><button class=\"btn btn-danger\" duck-button=\"delete\"><i class=\"fa fa-times\" aria-hidden=\"true\"></i><span class=\"sr-only\">Delete</span></button></div></div>'));\r\n\t});\r\n}(jQuery.noConflict(), duck);"]}