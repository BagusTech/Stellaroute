{"version":3,"sources":["js/pages/profile/profile.js"],"names":["$","$error","$userForm","$userSubmit","find","val","$username","startingUsername","$profilePicture","$profilePictureForm","startingProfilePicture","$bannerImage","$bannerImageForm","startingBannerImage","$firstName","$lastName","$tagline","prop","newUsername","duck","exists","field","value","fineOne","length","trigger","on","removeClass","duckForm","successCallback","newProfilePicture","newBannerImage","newFirstName","newLastName","summernote","newAboutMe","text","$aboutMe","$aboutMeTab","addClass","toLowerCase","window","location","href","_newProfilePicture","split","join","newProfilePicturePath","_newBannerImage","newBannerImagePath","errorCallBack","clone","_$error","setTimeout","$changePasswordModal","$changePasswordForm","$passwordFields","e","stopPropagation","eq","$passwordSubmit","closest","modal","$newGuideForm","$newGuideSubmit","jQuery","noConflict"],"mappings":"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","file":"profile.min.js","sourcesContent":["/* global jQuery, duck */\r\n\r\nvoid function initRequest($){\r\n\t'use strict';\r\n\r\n\t$(() => {\r\n\t\tconst $error = $('<div class=\"alert alert-danger p-A z-1 l-0 r-0 t-0\">Something went wrong, please try again.</div>');\r\n\r\n\t// USER FORM\r\n\t\tconst $userForm = $('#MySettings [duck-table=\"Users\"]');\r\n\t\tconst $userSubmit = $userForm.find('[duck-button=\"submit\"]');\r\n\t\tconst $username = $userForm.find('[duck-field=\"username\"] [duck-value]');\r\n\t\tconst startingUsername = $username.val();\r\n\t\tconst $profilePicture = $('.js-profile-pic');\r\n\t\tconst $profilePictureForm = $userForm.find('[duck-field=\"profilePicture\"] [duck-value]');\r\n\t\tconst startingProfilePicture = $profilePictureForm.val();\r\n\t\tconst $bannerImage = $('.js-banner-image');\r\n\t\tconst $bannerImageForm = $userForm.find('[duck-field=\"bannerImage\"] [duck-value]');\r\n\t\tconst startingBannerImage = $bannerImageForm.val();\r\n\t\tconst $firstName = $('.js-first-name');\r\n\t\tconst $lastName = $('.js-last-name');\r\n\t\tconst $tagline = $('.js-tagline');\r\n\t\tconst $aboutMeTab = $('.js-about-me-tab');\r\n\t\tconst $aboutMe = $('.js-about-me');\r\n\r\n\r\n\r\n\t\t$username.prop('validateFunc', () => () => {\r\n\t\t\tconst newUsername = $username.val();\r\n\t\t\t\r\n\t\t\tduck('Users').exists({field: 'username', value: newUsername, fineOne: true}, (length) => {\r\n\t\t\t\tif (length === \"0\" || startingUsername === newUsername) {\r\n\t\t\t\t\t$username.trigger('passedValidation');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$username.trigger('failedValidation');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$userForm.on('duck.form.submitted', () => {\r\n\t\t\t$userSubmit.prop('disabled', true);\r\n\t\t\t$userSubmit.find('i').removeClass('hidden');\r\n\t\t});\r\n\r\n\t\t$userForm.duckForm({successCallback: () => {\r\n\t\t\tconst newUsername = $username.val();\r\n\t\t\tconst newProfilePicture = $profilePictureForm.val();\r\n\t\t\tconst newBannerImage = $bannerImageForm.val();\r\n\t\t\tconst newFirstName = $userForm.find('[duck-field=\"first\"] [duck-value]').val();\r\n\t\t\tconst newLastName = $userForm.find('[duck-field=\"last\"] [duck-value]').val();\r\n\t\t\tconst newTagline = $userForm.find('[duck-field=\"tagline\"] [duck-value]').val();\r\n\t\t\tconst newAboutMe = $userForm.find('[duck-field=\"description\"] .summernote').summernote('code');\r\n\r\n\t\t\t$firstName.text(newFirstName);\r\n\t\t\t$lastName.text(newLastName);\r\n\t\t\t$tagline.text(newTagline);\r\n\t\t\t$aboutMe.html(newAboutMe);\r\n\r\n\t\t\t$tagline.removeClass('hidden');\r\n\t\t\t$aboutMeTab.removeClass('hidden');\r\n\r\n\t\t\t$userSubmit.prop('disabled', false).find('i').addClass('hidden');\r\n\r\n\t\t\t// if username changed refresh page\r\n\t\t\tif(newUsername.toLowerCase() !== startingUsername.toLowerCase()) {\r\n\t\t\t\twindow.location.href = `/${newUsername}`;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// update profile picture\r\n\t\t\tif(newProfilePicture !== startingProfilePicture) {\r\n\t\t\t\tconst _newProfilePicture = newProfilePicture.split('.');\r\n\t\t\t\t\t_newProfilePicture.pop();\r\n\t\t\t\t\r\n\t\t\t\tconst newProfilePicturePath = `https://s3-us-west-2.amazonaws.com/stellaroute/${_newProfilePicture.join('.')}-thumb2.jpg`;\r\n\t\t\t\t\r\n\t\t\t\t$profilePicture.attr('src', newProfilePicturePath);\r\n\t\t\t}\r\n\r\n\t\t\t// update banner image\r\n\t\t\tif(newBannerImage !== startingBannerImage) {\r\n\t\t\t\tconst _newBannerImage = newBannerImage.split('.');\r\n\t\t\t\t\t_newBannerImage.pop();\r\n\t\t\t\t\r\n\t\t\t\tconst newBannerImagePath = `https://s3-us-west-2.amazonaws.com/stellaroute/${_newBannerImage}-large.jpg`;\r\n\r\n\t\t\t\t$bannerImage.css('background-image', `url(\"${newBannerImagePath}\")`);\r\n\t\t\t}\r\n\r\n\t\t}, errorCallBack: () => {\r\n\t\t\tconst _$error = $error.clone();\r\n\r\n\t\t\t$userSubmit.prop('disabled', false).find('i').addClass('hidden');\r\n\t\t\t$userForm.append(_$error);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.slideUp(270);\t\t\t\t\r\n\t\t\t}, 3000);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.remove();\t\t\t\t\r\n\t\t\t}, 3270);\r\n\t\t}});\r\n\r\n\t// CHANGE PASSWORD FORM\r\n\t\tconst $changePasswordModal = $('#ChangePassword'); \r\n\t\tconst $changePasswordForm = $changePasswordModal.find('[duck-table=\"Users\"]');\r\n\t\tconst $passwordFields = $changePasswordForm.find('input[type=\"password\"]');\r\n\t\tconst $passwordSubmit = $changePasswordForm.find('[duck-button=\"submit\"]');\r\n\r\n\t\t$passwordFields.on('input', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif($passwordFields.eq(0).val() && !$passwordFields.eq(1).val()) {\r\n\t\t\t\t$passwordSubmit.prop('disabled', true);\r\n\t\t\t} else if(($passwordFields.eq(0).val() !== $passwordFields.eq(1).val()) || $passwordFields.eq(0).val().length < 8 || $passwordFields.eq(1).val().length < 8) {\r\n\t\t\t\t$passwordSubmit.prop('disabled', true);\r\n\t\t\t\t$passwordFields.closest('.form-group').addClass('has-error');\r\n\t\t\t} else {\r\n\t\t\t\t$passwordFields.closest('.form-group').removeClass('has-error');\r\n\t\t\t\t$passwordSubmit.prop('disabled', false);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$changePasswordForm.on('duck.form.submitted', () => {\r\n\t\t\t$passwordSubmit.prop('disabled', true);\r\n\t\t\t$passwordSubmit.find('i').removeClass('hidden');\r\n\t\t});\r\n\r\n\t\t$changePasswordForm.duckForm({successCallback: () => {\r\n\t\t\t$passwordSubmit.prop('disabled', false).find('i').addClass('hidden');\r\n\t\t\t$changePasswordModal.modal('hide');\r\n\t\t}});\r\n\r\n\t// NEW GUIDE FORM\r\n\t\tconst $newGuideForm = $('[duck-table=\"Guides\"]');\r\n\t\tconst $newGuideSubmit = $newGuideForm.find('[duck-button=\"submit\"]');\r\n\r\n\t\t$newGuideSubmit.on('click', () => {\r\n\t\t\t$newGuideSubmit.append('<i class=\"fa fa-spin fa-spinner\"></i>');\r\n\t\t});\r\n\r\n\t\t$newGuideForm.duckForm({successCallback: () => {\r\n\t\t\twindow.location = `${window.location.pathname}/${$('[duck-field=\"url\"] [duck-value]').val()}`;\r\n\t\t}});\r\n\t});\r\n\r\n}(jQuery.noConflict())"]}