{"version":3,"sources":["js/pages/profile/profile.js"],"names":["$","$error","$userForm","$userSubmit","find","val","$username","startingUsername","$profilePicture","$profilePictureForm","startingProfilePicture","$bannerImage","$bannerImageForm","prop","duck","newUsername","value","fineOne","length","trigger","exists","on","removeClass","successCallback","newProfilePicture","addClass","window","location","href","_newProfilePicture","split","pop","join","attr","newProfilePicturePath","newBannerImage","startingBannerImage","_newBannerImage","css","newBannerImagePath","_$error","clone","append","slideUp","setTimeout","remove","$changePasswordModal","$changePasswordForm","$passwordFields","$passwordSubmit","e","stopPropagation","preventDefault","eq","closest","duckForm","$newGuideForm","$newGuideSubmit","pathname","jQuery","noConflict"],"mappings":"iBAAA,UAAAA,GAGCA,EAAA,WAGC,GAAMC,GAASD,EAAE,qGAGXE,EAAYF,EAAE,oCADrBG,EAAAD,EAAAE,KAAA,0BACOF,EAAcA,EAAAE,KAAA,wCACdD,EAAcD,EAAeG,MAC7BC,EAAYJ,EAAUE,mBACtBG,EAAmBD,EAAzBF,KAAA,8CACMI,EAAoBC,EAA1BJ,MACMI,EAAAA,EAAAA,oBACAC,EAAAA,EAAyBD,KAAAA,2CACzBE,EAAiBC,EAAvBP,KAKAC,GAAUO,KAAK,eAAgB,WAAA,MAAM,YAArCP,GAAAA,GAAeA,EAAgBD,KAC9BS,MAAMC,SAAAA,QAAcT,MAAUD,WAA9BW,MAAAD,EAAAE,SAAA,GAAA,SAAAC,GAGgB,MAAXA,GAAkBX,IAAqBQ,EAD5CD,EAAKK,QAASC,oBAEZd,EAAAA,QAAA,yBAKFH,EAV8BkB,GAAA,QAAA,WAA/BlB,EAAAC,KAAA,KAAAkB,YAAA,YAaCnB,EAAAA,UAAiBoB,gBAAiB,WADnC,GAAAR,GAAAT,EAAAD,MAMOmB,EAAoBf,EAAoBJ,MAF/CH,EAAoBqB,EAAiBlB,KAKpCF,IAHAA,EAAMqB,KAAAA,YAAoBf,GAAAA,KAAAA,KAAoBJ,SAA9C,UAGAF,EAAYU,gBAAiBN,EAAiBkB,cAE9C,YAECC,OAAOC,SAASC,KAAhB,IAA2Bb,EAE3B,IAAAS,IAAAd,EAAA,CAIA,GAAMmB,GAAqBL,EAAkBM,MAAM,IAFpDD,GAAAE,KAEC,IAAMF,GAAAA,kDAANA,EAAAG,KAAA,KAAMH,aAKNrB,GAAgByB,KAAK,MAAOC,GAC5B,GAAAC,IAAAC,EAAA,CAIA,GAAMC,GAAkBF,EAAeL,MAAM,IAF9CO,GAAAN,KAEC,IAAMM,GAAAA,kDAANA,EAAMA,YAKN1B,GAAa2B,IAAI,mBAAjB,QAA6CC,EAA7C,QAAA5B,cAAa2B,WACb,GAAAE,GAAAvC,EAAAwC,OAGDtC,GAAMqC,KAAUvC,YAAhB,GAAAG,KAAA,KAAAqB,SAAA,UAGAvB,EAAUwC,OAAOF,GAAjBtC,WAAUwC,WAGTF,EAAQG,QAAQ,MADjBC,KAECA,WAFD,WAKCJ,EAAQK,UADTD,QAMD,IAAME,GAAuB9C,EAAE,mBADhC+C,EAAAD,EAAA1C,KAAA,wBACO0C,EAAAA,EAAyB1C,KAA/B,0BACM2C,EAAAA,EAAsBD,KAAqB1C,yBAEjD4C,GAAMC,GAAAA,QAAkBF,SAAAA,GAGvBG,EAAEC,kBADHH,EAAAA,iBAEGI,EAAFC,GAAA,GAAAhD,QAAA2C,EAAAK,GAAA,GAAAhD,OAAA2C,EAAAK,GAAA,GAAAhD,MAAAa,OAAA,GAAA8B,EAAAK,GAAA,GAAAhD,MAAAa,OAAA,GAGC+B,EAAgBpC,KAAK,YAAY,GADlCmC,EAAIA,QAAA,eAAgCA,SAAAA,eAEnCA,EAAgBM,QAAQ,eAAe7B,YAAS,aAFjDwB,EAGOpC,KAAA,YAAA,MAIPoC,EAXD5B,GAAA,QAAA,WAcC4B,EAAgB7C,KAAK,KAAKkB,YAAY,YACtCyB,EAFDQ,UAAAhC,gBAAA,WAKC0B,EAAgBpC,KAAK,YAAY,GAAOT,KAAK,KAAKqB,SAAS,UAD5DsB,EAAoBQ,MAApB,UAMA,IAAMC,GAAgBxD,EAAE,yBADzByD,EAAAD,EAAApD,KAAA,yBAECqD,GAAMA,GAAAA,QAAkBD,WAGvBC,EAAgBf,OAAO,2CACvBc,EAFDD,UAAAhC,gBAAA,WAKCG,OAAOC,SAAcD,OAAOC,SAAS+B,SAArC,IAAiD1D,EAAE,mCAAmCK,YArHxFsD,OAAAC","file":"profile.min.js","sourcesContent":["/* global jQuery, duck */\r\n\r\nvoid function initRequest($){\r\n\t'use strict';\r\n\r\n\t$(() => {\r\n\t\tconst $error = $('<div class=\"alert alert-danger p-A z-1 l-0 r-0 t-0\">Something went wrong, please try again.</div>');\r\n\r\n\t// USER FORM\r\n\t\tconst $userForm = $('#MySettings [duck-table=\"Users\"]');\r\n\t\tconst $userSubmit = $userForm.find('[duck-button=\"submit\"]');\r\n\t\tconst $username = $userForm.find('[duck-field=\"username\"] [duck-value]');\r\n\t\tconst startingUsername = $username.val();\r\n\t\tconst $profilePicture = $('.js-profile-pic');\r\n\t\tconst $profilePictureForm = $userForm.find('[duck-field=\"profilePicture\"] [duck-value]');\r\n\t\tconst startingProfilePicture = $profilePictureForm.val();\r\n\t\tconst $bannerImage = $('.js-banner-image');\r\n\t\tconst $bannerImageForm = $userForm.find('[duck-field=\"bannerImage\"] [duck-value]');\r\n\t\tconst startingBannerImage = $bannerImageForm.val();\r\n\r\n\r\n\t\t$username.prop('validateFunc', () => () => {\r\n\t\t\tconst newUsername = $username.val();\r\n\t\t\t\r\n\t\t\tduck('Users').exists({field: 'username', value: newUsername, fineOne: true}, (length) => {\r\n\t\t\t\tif (length === \"0\" || startingUsername === newUsername) {\r\n\t\t\t\t\t$username.trigger('passedValidation');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$username.trigger('failedValidation');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$userSubmit.on('click', () => {\r\n\t\t\t$userSubmit.find('i').removeClass('hidden');\r\n\t\t});\r\n\r\n\t\t$userForm.duckForm({successCallback: () => {\r\n\t\t\tconst newUsername = $username.val();\r\n\t\t\tconst newProfilePicture = $profilePictureForm.val();\r\n\t\t\tconst newBannerImage = $bannerImageForm.val();\r\n\r\n\t\t\t$userSubmit.prop('disabled', false).find('i').addClass('hidden');\r\n\r\n\t\t\t// if username changed refresh page\r\n\t\t\tif(newUsername.toLowerCase() !== startingUsername.toLowerCase()) {\r\n\t\t\t\twindow.location.href = `/${newUsername}`;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// update profile picture\r\n\t\t\tif(newProfilePicture !== startingProfilePicture) {\r\n\t\t\t\tconst _newProfilePicture = newProfilePicture.split('.');\r\n\t\t\t\t\t_newProfilePicture.pop();\r\n\t\t\t\t\r\n\t\t\t\tconst newProfilePicturePath = `https://s3-us-west-2.amazonaws.com/stellaroute/${_newProfilePicture.join('.')}-thumb2.jpg`;\r\n\t\t\t\t\r\n\t\t\t\t$profilePicture.attr('src', newProfilePicturePath);\r\n\t\t\t}\r\n\r\n\t\t\t// update banner image\r\n\t\t\tif(newBannerImage !== startingBannerImage) {\r\n\t\t\t\tconst _newBannerImage = newBannerImage.split('.');\r\n\t\t\t\t\t_newBannerImage.pop();\r\n\t\t\t\t\r\n\t\t\t\tconst newBannerImagePath = `https://s3-us-west-2.amazonaws.com/stellaroute/${_newBannerImage}-large.jpg`;\r\n\r\n\t\t\t\t$bannerImage.css('background-image', `url(\"${newBannerImagePath}\")`);\r\n\t\t\t}\r\n\r\n\t\t}, errorCallBack: () => {\r\n\t\t\tconst _$error = $error.clone();\r\n\r\n\t\t\t$userSubmit.prop('disabled', false).find('i').addClass('hidden');\r\n\t\t\t$userForm.append(_$error);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.slideUp(270);\t\t\t\t\r\n\t\t\t}, 3000);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.remove();\t\t\t\t\r\n\t\t\t}, 3270);\r\n\t\t}});\r\n\r\n\t// CHANGE PASSWORD FORM\r\n\t\tconst $changePasswordModal = $('#ChangePassword'); \r\n\t\tconst $changePasswordForm = $changePasswordModal.find('[duck-table=\"Users\"]');\r\n\t\tconst $passwordFields = $changePasswordForm.find('input[type=\"password\"]');\r\n\t\tconst $passwordSubmit = $changePasswordForm.find('[duck-button=\"submit\"]');\r\n\r\n\t\t$passwordFields.on('input', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif(($passwordFields.eq(0).val() !== $passwordFields.eq(1).val()) || $passwordFields.eq(0).val().length < 6 || $passwordFields.eq(1).val().length < 6) {\r\n\t\t\t\t$passwordSubmit.prop('disabled', true);\r\n\t\t\t\t$passwordFields.closest('.form-group').addClass('has-error');\r\n\t\t\t} else {\r\n\t\t\t\t$passwordFields.closest('.form-group').removeClass('has-error');\r\n\t\t\t\t$passwordSubmit.prop('disabled', false);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$passwordSubmit.on('click', () => {\r\n\t\t\t$passwordSubmit.find('i').removeClass('hidden');\r\n\t\t});\r\n\r\n\t\t$changePasswordForm.duckForm({successCallback: () => {\r\n\t\t\t$passwordSubmit.prop('disabled', false).find('i').addClass('hidden');\r\n\t\t\t$changePasswordModal.modal('hide');\r\n\t\t}});\r\n\r\n\t// NEW GUIDE FORM\r\n\t\tconst $newGuideForm = $('[duck-table=\"Guides\"]');\r\n\t\tconst $newGuideSubmit = $newGuideForm.find('[duck-button=\"submit\"]');\r\n\r\n\t\t$newGuideSubmit.on('click', () => {\r\n\t\t\t$newGuideSubmit.append('<i class=\"fa fa-spin fa-spinner\"></i>');\r\n\t\t});\r\n\r\n\t\t$newGuideForm.duckForm({successCallback: () => {\r\n\t\t\twindow.location = `${window.location.pathname}/${$('[duck-field=\"url\"] [duck-value]').val()}`;\r\n\t\t}});\r\n\t});\r\n\r\n}(jQuery.noConflict())"]}