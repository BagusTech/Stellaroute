{"version":3,"sources":["js/pages/profile/profile.js"],"names":["$","$error","$userForm","$userSubmit","find","val","$username","startingUsername","$profilePicture","$profilePictureForm","startingProfilePicture","$bannerImage","$bannerImageForm","startingBannerImage","$firstName","$lastName","$tagline","$aboutMe","newUsername","duck","exists","field","value","fineOne","length","trigger","on","prop","removeClass","successCallback","newProfilePicture","newBannerImage","summernote","newLastName","newTagline","newAboutMe","html","text","addClass","toLowerCase","href","_newProfilePicture","split","pop","join","newProfilePicturePath","_newBannerImage","newBannerImagePath","errorCallBack","css","clone","_$error","slideUp","remove","$changePasswordModal","$changePasswordForm","$passwordFields","e","stopPropagation","preventDefault","eq","$passwordSubmit","closest","modal","$newGuideForm","$newGuideSubmit","window","location","pathname","jQuery","noConflict"],"mappings":"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","file":"profile.min.js","sourcesContent":["/* global jQuery, duck */\r\n\r\nvoid function initRequest($){\r\n\t'use strict';\r\n\r\n\t$(() => {\r\n\t\tconst $error = $('<div class=\"alert alert-danger p-A z-1 l-0 r-0 t-0\">Something went wrong, please try again.</div>');\r\n\r\n\t// USER FORM\r\n\t\tconst $userForm = $('#Settings [duck-table=\"Users\"]');\r\n\t\tconst $userSubmit = $userForm.find('[duck-button=\"submit\"]');\r\n\t\tconst $username = $userForm.find('[duck-field=\"username\"] [duck-value]');\r\n\t\tconst startingUsername = $username.val();\r\n\t\tconst $profilePicture = $('.js-profile-pic');\r\n\t\tconst $profilePictureForm = $userForm.find('[duck-field=\"profilePicture\"] [duck-value]');\r\n\t\tconst startingProfilePicture = $profilePictureForm.val();\r\n\t\tconst $bannerImage = $('.js-banner-image');\r\n\t\tconst $bannerImageForm = $userForm.find('[duck-field=\"bannerImage\"] [duck-value]');\r\n\t\tconst startingBannerImage = $bannerImageForm.val();\r\n\t\tconst $firstName = $('.js-first-name');\r\n\t\tconst $lastName = $('.js-last-name');\r\n\t\tconst $tagline = $('.js-tagline');\r\n\t\tconst $aboutMeTab = $('.js-about-me-tab');\r\n\t\tconst $aboutMe = $('.js-about-me');\r\n\r\n\t\t$username.prop('validateFunc', () => () => {\r\n\t\t\tconst newUsername = $username.val();\r\n\t\t\t\r\n\t\t\tduck('Users').exists({field: 'username', value: newUsername, fineOne: true}, (length) => {\r\n\t\t\t\tif (length === \"0\" || startingUsername === newUsername) {\r\n\t\t\t\t\t$username.trigger('passedValidation');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$username.trigger('failedValidation');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$userForm.on('duck.form.submitted', () => {\r\n\t\t\t$userSubmit.prop('disabled', true);\r\n\t\t\t$userSubmit.find('i').removeClass('hidden');\r\n\t\t});\r\n\r\n\t\t$userForm.duckForm({successCallback: () => {\r\n\t\t\tconst newUsername = $username.val();\r\n\t\t\tconst newProfilePicture = $profilePictureForm.val();\r\n\t\t\tconst newBannerImage = $bannerImageForm.val();\r\n\t\t\tconst newFirstName = $userForm.find('[duck-field=\"first\"] [duck-value]').val();\r\n\t\t\tconst newLastName = $userForm.find('[duck-field=\"last\"] [duck-value]').val();\r\n\t\t\tconst newTagline = $userForm.find('[duck-field=\"tagline\"] [duck-value]').val();\r\n\t\t\tconst newAboutMe = $userForm.find('[duck-field=\"description\"] .summernote').summernote('code');\r\n\r\n\t\t\t$firstName.text(newFirstName);\r\n\t\t\t$lastName.text(newLastName);\r\n\t\t\t$tagline.text(newTagline);\r\n\t\t\t$aboutMe.html(newAboutMe);\r\n\r\n\t\t\t$tagline.removeClass('hidden');\r\n\t\t\t$aboutMeTab.removeClass('hidden');\r\n\r\n\t\t\t$userSubmit.prop('disabled', false).find('i').addClass('hidden');\r\n\r\n\t\t\t// if username changed refresh page\r\n\t\t\tif(newUsername.toLowerCase() !== startingUsername.toLowerCase()) {\r\n\t\t\t\twindow.location.href = `/${newUsername}`;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// update profile picture\r\n\t\t\tif(newProfilePicture !== startingProfilePicture) {\r\n\t\t\t\tconst _newProfilePicture = newProfilePicture.split('.');\r\n\t\t\t\t\t_newProfilePicture.pop();\r\n\t\t\t\t\r\n\t\t\t\tconst newProfilePicturePath = `https://s3-us-west-2.amazonaws.com/stellaroute/${_newProfilePicture.join('.')}-thumb2.jpg`;\r\n\t\t\t\t\r\n\t\t\t\t$profilePicture.attr('src', newProfilePicturePath);\r\n\t\t\t}\r\n\r\n\t\t\t// update banner image\r\n\t\t\tif(newBannerImage !== startingBannerImage) {\r\n\t\t\t\tconst _newBannerImage = newBannerImage.split('.');\r\n\t\t\t\t\t_newBannerImage.pop();\r\n\t\t\t\t\r\n\t\t\t\tconst newBannerImagePath = `https://s3-us-west-2.amazonaws.com/stellaroute/${_newBannerImage}-large.jpg`;\r\n\r\n\t\t\t\t$bannerImage.css('background-image', `url(\"${newBannerImagePath}\")`);\r\n\t\t\t}\r\n\r\n\t\t}, errorCallBack: () => {\r\n\t\t\tconst _$error = $error.clone();\r\n\r\n\t\t\t$userSubmit.prop('disabled', false).find('i').addClass('hidden');\r\n\t\t\t$userForm.append(_$error);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.slideUp(270);\t\t\t\t\r\n\t\t\t}, 3000);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t_$error.remove();\t\t\t\t\r\n\t\t\t}, 3270);\r\n\t\t}});\r\n\r\n\t// CHANGE PASSWORD FORM\r\n\t\tconst $changePasswordModal = $('#ChangePassword'); \r\n\t\tconst $changePasswordForm = $changePasswordModal.find('[duck-table=\"Users\"]');\r\n\t\tconst $passwordFields = $changePasswordForm.find('input[type=\"password\"]');\r\n\t\tconst $passwordSubmit = $changePasswordForm.find('[duck-button=\"submit\"]');\r\n\r\n\t\t$passwordFields.on('input', (e) => {\r\n\t\t\te.stopPropagation();\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif($passwordFields.eq(0).val() && !$passwordFields.eq(1).val()) {\r\n\t\t\t\t$passwordSubmit.prop('disabled', true);\r\n\t\t\t} else if(($passwordFields.eq(0).val() !== $passwordFields.eq(1).val()) || $passwordFields.eq(0).val().length < 8 || $passwordFields.eq(1).val().length < 8) {\r\n\t\t\t\t$passwordSubmit.prop('disabled', true);\r\n\t\t\t\t$passwordFields.closest('.form-group').addClass('has-error');\r\n\t\t\t} else {\r\n\t\t\t\t$passwordFields.closest('.form-group').removeClass('has-error');\r\n\t\t\t\t$passwordSubmit.prop('disabled', false);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$changePasswordForm.on('duck.form.submitted', () => {\r\n\t\t\t$passwordSubmit.prop('disabled', true);\r\n\t\t\t$passwordSubmit.find('i').removeClass('hidden');\r\n\t\t});\r\n\r\n\t\t$changePasswordForm.duckForm({successCallback: () => {\r\n\t\t\t$passwordSubmit.prop('disabled', false).find('i').addClass('hidden');\r\n\t\t\t$changePasswordModal.modal('hide');\r\n\t\t}});\r\n\r\n\t// NEW GUIDE FORM\r\n\t\tconst $newGuideForm = $('[duck-table=\"Guides\"]');\r\n\t\tconst $newGuideSubmit = $newGuideForm.find('[duck-button=\"submit\"]');\r\n\r\n\t\t$newGuideSubmit.on('click', () => {\r\n\t\t\t$newGuideSubmit.append('<i class=\"fa fa-spin fa-spinner\"></i>');\r\n\t\t});\r\n\r\n\t\t$newGuideForm.duckForm({successCallback: () => {\r\n\t\t\twindow.location = `${window.location.pathname}/${$('[duck-field=\"url\"] [duck-value]').val()}`;\r\n\t\t}});\r\n\t});\r\n\r\n}(jQuery.noConflict())"]}